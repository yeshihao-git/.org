:PROPERTIES:
:ID:       514da3f2-517e-4419-a6ca-77753fb1d280
:END:
#+title: 调试策略
#+filetags: cpp

* 调试策略
|------------------------+-----------------------------------------------------------+------|
| 调试策略               | 说明                                                      |      |
|------------------------+-----------------------------------------------------------+------|
| 注释代码               | 简单判断问题位置，不好还原代码                            |      |
| 打印日志               | /程序输出/ 杂乱                                             |      |
| 条件判断（预处理指令） | 通过注释控制打印日志，程序输出 不会杂乱，代码 杂乱 [fn:1] |      |
| 日志记录器             | 日志记录到文件中，程序输出、代码 不会杂乱 [fn:2]          | *推荐* |
| 调试器                 | 控制程序的执行、查看程序状态（eg：[[id:8a46ff3c-7b8e-42e8-a6c9-bdaf55195c4a][gdb]]）                   | *推荐* |
|------------------------+-----------------------------------------------------------+------|
- 日志 :: 顺序记录发生的事情，且带有时间戳


** C++调试
:PROPERTIES:
:ID:       d5178da7-38c0-4903-91bd-a1cbc3551f9a
:END:
1. [[id:8a46ff3c-7b8e-42e8-a6c9-bdaf55195c4a][gdb]]     ：调用栈信息
2. 日志    ：死锁问题
3. assert  ：内存泄漏问题
4. 测试用例：多线程


* Footnotes

[fn:1]
#+begin_src cpp :results output :namespaces std :includes <iostream>
#define ENABLE_DEBUG    // 写入一个 头文件，在其他地方包含，通过注释的方式，就能一键启用/关闭

int getUserInput() {
#ifdef ENABLE_DEBUG
std::cerr << "getUserInput() called\n";
#endif
   std::cout << "Enter a number: ";
   int x{};
   std::cin >> x;
   return x;
}

int main() {
#ifdef ENABLE_DEBUG
std::cerr << "main() called\n";
#endif
    int x{ getUserInput() };
    std::cout << "You entered: " << x << '\n';
}
#+end_src

[fn:2]
#+name: 第三方日志库 plog 使用示例
#+begin_src cpp
#include <plog/Log.h> // Step 1: include the logger headers
#include <plog/Initializers/RollingFileInitializer.h>

int getUserInput() {
  PLOGD << "getUserInput() called"; // PLOGD is defined by the plog library
  std::cout << "Enter a number: ";
  int x{};
  std::cin >> x;
  return x;
}

int main() {
  plog::init(plog::debug, "Logfile.txt"); // Step 2: initialize the logger
  PLOGD << "main() called"; // Step 3: Output to the log as if you were writing to the console
  int x{ getUserInput() };
  std::cout << "You entered: " << x << '\n';
}

/* Logfile.txt 文件中 */
2018-12-26 20:03:33.295 DEBUG [4752] [main@19] main() called
2018-12-26 20:03:33.296 DEBUG [4752] [getUserInput@7] getUserInput() called

#+end_src
