:PROPERTIES:
:ID:       77c81947-ba5c-4bad-93da-03bb11cee093
:END:
#+title: å¸¸é‡
#+filetags: cpp

* å¸¸é‡
- å¸¸é‡ ::  *å€¼ä¸å¯ä¿®æ”¹* çš„å®ä½“é‡ï¼ŒåŒ…å«ï¼š
  1. [[id:83a02125-329f-4097-ac5e-b14fbe1240ab][å­—é¢é‡]]ï¼ˆæ— æ ‡è¯†ç¬¦çš„ç›´æ¥å¸¸é‡å€¼ï¼‰
  2. å‘½åå¸¸é‡ï¼ˆå¸¦æ ‡è¯†ç¬¦çš„ const/constexpr å˜é‡ï¼‰
     - è¿è¡Œæ—¶å¸¸é‡ :: [[id:7d0a7aab-3355-404e-af3a-ea3d0353fc61][const]]å¸¸é‡
     - ç¼–è¯‘æ—¶å¸¸é‡ :: [[id:6881d753-91d9-4382-8f31-2f9315074183][constexpr]]å¸¸é‡
#+begin_example cpp
// å‘½åå¸¸é‡
const int MAX = 100;
constexpr double PI = 3.14;

// å­—é¢é‡
100, 3.14, "hello", true;
#+end_example


** å¸¸é‡è¡¨è¾¾å¼
:PROPERTIES:
:ID:       127cefde-76f3-437b-ba9c-72ed8e928498
:END:
- å¸¸é‡è¡¨è¾¾å¼ :: ç¼–è¯‘æœŸå¯è®¡ç®—çš„è¡¨è¾¾å¼ã€‚å¸¸è§çš„å¸¸é‡è¡¨è¾¾å¼ï¼š
  1. [[id:83a02125-329f-4097-ac5e-b14fbe1240ab][å­—é¢é‡]]
  2. å¸¸é‡è¡¨è¾¾å¼ å’Œ è¿ç®—ç¬¦ ç»„åˆæˆçš„å¸¸é‡è¡¨è¾¾å¼ï¼ˆegï¼š3 + 4ï¼‰
  3. ç”¨å¸¸é‡è¡¨è¾¾å¼åˆå§‹åŒ–çš„ =const int= [fn:1]
  4. constexprå˜é‡
  5. constexprå‡½æ•°
  6. constexpr lambdas
  7. éç±»å‹æ¨¡æ¿å‚æ•°
  8. [[id:d091d455-5933-4047-92fb-4c2d2d2f7ff9][æšä¸¾]]æˆå‘˜
  9. ç±»å‹ç‰¹æ€§ =<type_traits>=  [[[https://en.cppreference.com/w/cpp/header/type_traits.html][cppreference]]]


** å­—é¢é‡
:PROPERTIES:
:ID:       83a02125-329f-4097-ac5e-b14fbe1240ab
:END:
- å­—é¢é‡ :: ç›´æ¥åµŒå…¥åˆ°æºä»£ç ä¸­çš„ [[id:b06260e2-ed7a-4b12-8e9d-b07a3e564a75][constexpr]] å€¼ï¼Œæ˜¯ [[id:77c81947-ba5c-4bad-93da-03bb11cee093][ç¼–è¯‘æ—¶å¸¸é‡]]ï¼Œåœ¨ *ç¼–è¯‘æœŸåˆå§‹åŒ–* ï¼Œå…·æœ‰é™æ€[[id:48f60537-4554-4d24-98fb-65f8a3bbbcf6][å­˜å‚¨æœŸ]]
  1. å­—é¢é‡æœ‰ *é»˜è®¤ç±»å‹* ï¼Œå¯æ ¹æ®å…¶ value æ¨å¯¼å‡ºçš„ type
   |-------------+---------------+-------------------------+-------------|
   | å­—é¢å€¼      | ç¤ºä¾‹          | é»˜è®¤å­—é¢å€¼ç±»å‹          | å¤‡æ³¨        |
   |-------------+---------------+-------------------------+-------------|
   | æ•´å‹å€¼      | 5ï¼Œ0ï¼Œ-3      | int                     |             |
   | å¸ƒå°”å€¼      | trueï¼Œfalse   | bool                    |             |
   | æµ®ç‚¹å€¼      | 1.2ï¼Œ3.4      | doubleï¼ˆ *not floatï¼* ï¼‰ |             |
   | å­—ç¬¦        | 'a'ï¼Œ'\n'     | char                    |             |
   | Cé£æ ¼å­—ç¬¦ä¸² | "hello,world" | const char[]            | é»˜è®¤æ·»åŠ  \0 |
   |-------------+---------------+-------------------------+-------------|
  2. æ”¹å˜æ¨å¯¼å‡ºçš„å­—é¢é‡typeï¼Œä½¿ç”¨ *å­—é¢é‡åç¼€* [fn:2]
   |--------+------+--------------------|
   | ç±»å‹   | åç¼€ | å«ä¹‰               |
   |--------+------+--------------------|
   | æ•´å‹   | u    | unsigned int       |
   | æ•´å‹   | l    | long               |
   | æ•´å‹   | ul   | unsigned long      |
   | æ•´å‹   | ll   | long long          |
   | æ•´å‹   | ull  | unsigned long long |
   | æµ®ç‚¹   | f    | float              |
   | æµ®ç‚¹   | l    | long double        |
   | string | s    | std::string        |
   | string | sv   | std::string_view   |
   |--------+------+--------------------|


*** å­—ç¬¦ä¸²å­—é¢é‡
:PROPERTIES:
:ID:       29178bb3-f004-4d26-8e7d-5ddd929feb46
:END:
- å­—ç¬¦ä¸²å­—é¢é‡ :: åŒå¼•å·åŒ…è£¹ï¼Œä»¥ =\0= ç»“å°¾çš„å­—ç¬¦åºåˆ—å¸¸é‡ï¼ˆæœ¬è´¨æ˜¯ *const char[] Cé£æ ¼æ•°ç»„* / *Cé£æ ¼å­—ç¬¦ä¸²* ï¼‰
  1. ç›¸é‚»çš„å­—ç¬¦ä¸²å­—é¢é‡ä¼š *è‡ªåŠ¨æ‹¼æ¥* [fn:3]
#+begin_src cpp
"hello"                                     // æœ¬è´¨ï¼šconst char * æˆ– const char[]
list<const char *> ls = {"hello", "world"}; // è¿™é‡Œåªèƒ½ç”¨ const char *ï¼Œä¸èƒ½ç”¨ char *
#+end_src




** const
:PROPERTIES:
:ID:       7d0a7aab-3355-404e-af3a-ea3d0353fc61
:END:
- const :: cppä¸­çš„[[id:91e55c3a-c98d-4907-874c-453f5444b82a][ç±»å‹é™å®šç¬¦]]ï¼ˆä½œä¸ºç±»å‹ä¸€éƒ¨åˆ†ï¼‰ï¼ŒæŒ‡å®šæ‰€å£°æ˜çš„å¯¹è±¡ *åªè¯»* å±æ€§ï¼ˆè¿è¡Œæ—¶ä¸èƒ½ä¿®æ”¹å€¼ï¼‰
  1. ç¼–è¯‘æœŸã€è¿è¡ŒæœŸ æ±‚å€¼ï¼ˆ[[id:127cefde-76f3-437b-ba9c-72ed8e928498][å¸¸é‡è¡¨è¾¾å¼]] ä½œä¸ºåˆå§‹åŒ–å€¼æ—¶ï¼Œç¼–è¯‘æœŸæ±‚å€¼ï¼‰
  2. ğŸ”¥ const *ä¿®é¥°è§„åˆ™* ï¼šå…ˆå·¦åå³ï¼ˆç¤ºä¾‹è§ [[id:d3f3f997-867e-437f-b062-7cfca7ec5a19][constæŒ‡é’ˆ]]ï¼‰

*constä¿®é¥°æ€»ç»“*
1. const[[id:4276f9fb-4b68-4c73-bd8f-8a7c1e5f82a9][å˜é‡]]
2. [[id:d3f3f997-867e-437f-b062-7cfca7ec5a19][constæŒ‡é’ˆ]]
3. const[[id:1f772bce-0f88-46a2-ab44-c9bf04b30653][å¼•ç”¨]]
4. [[id:dba74038-4c01-4938-8947-24fa97149362][constå¯¹è±¡]]
5. [[id:8775da35-dc16-4293-9448-8a6dbdfaa382][constæˆå‘˜å˜é‡]]
6. [[id:227d0a2c-3565-4c5d-b02e-199f2d59d390][constæˆå‘˜å‡½æ•°]]


*** é¡¶å±‚constå’Œåº•å±‚const
:PROPERTIES:
:ID:       d9781d23-ff8a-4e3e-a677-932461947130
:END:
- é¡¶å±‚const :: ä¿®é¥° *è‡ªèº«*
- åº•å±‚const :: ä¿®é¥° *å¼•ç”¨/æŒ‡å‘çš„å¯¹è±¡*
#+begin_comment
æŒ‡é’ˆ å¯ä»¥æ˜¯ é¡¶/åº•const
å¼•ç”¨ å¯ä»¥æ˜¯ åº•const
#+end_comment

æ‹·è´æ—¶ï¼Œå¿½ç•¥ é¡¶å±‚constï¼Œä¿ç•™ åº•å±‚const [fn:4]


** constexpr
:PROPERTIES:
:ID:       6881d753-91d9-4382-8f31-2f9315074183
:END:
- constexpr :: éšå«constçš„ç‰¹æ€§ï¼ˆconstçš„è¶…é›†ï¼‰ï¼Œè¦æ±‚ å˜é‡/å‡½æ•°çš„å€¼ åœ¨ç¼–è¯‘æœŸå°±èƒ½è®¡ç®—å¾—åˆ°ï¼Œç”¨äº *æ€§èƒ½ä¼˜åŒ–*
  1. ç¼–è¯‘æœŸæ±‚å€¼ï¼ˆ[[id:127cefde-76f3-437b-ba9c-72ed8e928498][å¸¸é‡è¡¨è¾¾å¼]]åˆå§‹åŒ–æ—¶ï¼‰
  2. ç¼–è¯‘å™¨æä¾› *ç¼–è¯‘æœŸæ£€æŸ¥* ã€ä»¥åŠ *ä¼˜åŒ–* ï¼ˆè§ï¼š[[id:a047ed53-7758-4ecd-8451-1eaf172442eb][ç¼–è¯‘æœŸä¼˜åŒ–]]ï¼‰

*åˆ†ç±»*
1. [[id:cbbd7b79-3093-41fb-aed6-7edf1ef81282][constexprå˜é‡]]
2. [[id:331bfc0a-f7ce-4889-a753-5ff0bd3abe38][constexprå‡½æ•°]]

*ä½¿ç”¨åœºæ™¯*
1. [[id:9148c346-c9dd-4480-9b37-25d448987e98][éç±»å‹æ¨¡æ¿å®å‚]] çš„åˆå§‹å€¼
2. std::array å’Œ Cé£æ ¼æ•°ç»„ çš„æ•°ç»„é•¿åº¦


*** constexprå˜é‡
:PROPERTIES:
:ID:       cbbd7b79-3093-41fb-aed6-7edf1ef81282
:END:
- constexprå˜é‡ :: ç¼–è¯‘æœŸå¸¸é‡ï¼Œå¿…é¡»åœ¨ç¼–è¯‘æœŸæ±‚å€¼ï¼Œä½¿ç”¨ [[id:127cefde-76f3-437b-ba9c-72ed8e928498][å¸¸é‡è¡¨è¾¾å¼]] åˆå§‹åŒ– [fn:5]
  1. åŒ…å« éšå¼çš„[[id:7d0a7aab-3355-404e-af3a-ea3d0353fc61][const]]
  2. [[id:ec823c59-99d9-4818-a3a3-be1e01b55b3c][å†…éƒ¨é“¾æ¥æ€§]]
  3. é»˜è®¤ä¸æ˜¯ [[id:3e85303c-39c7-4ac3-9d88-a9513d036477][inline]]
  *whyï¼Ÿ*[fn:6]


*** constexprå‡½æ•°
:PROPERTIES:
:ID:       331bfc0a-f7ce-4889-a753-5ff0bd3abe38
:END:
- constexprå‡½æ•° :: å¯ä»¥åœ¨ç¼–è¯‘æœŸ/è¿è¡ŒæœŸæ±‚å€¼ï¼ˆå–å†³äºæ˜¯å¦åœ¨[[id:127cefde-76f3-437b-ba9c-72ed8e928498][å¸¸é‡è¡¨è¾¾å¼]]ä¸Šä¸‹æ–‡ï¼‰[fn:7]
  1. ä¸åŒ…å« éšå¼çš„[[id:1450514f-880d-42f5-8bb4-f114c1a5b675][const]]
  2. [[id:eeb84412-f94b-4f43-b67a-d1063fb7e106][å¤–éƒ¨é“¾æ¥æ€§]]
  3. é»˜è®¤ [[id:3e85303c-39c7-4ac3-9d88-a9513d036477][inline]]

* Footnotes

[fn:1]
#+begin_src cpp :results output :namespaces std :includes <iostream>
const int a {10};       // ç”±äºå†å²åŸå› ï¼ŒNOTE å®ƒæ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œèƒ½å¤Ÿåœ¨ç¼–è¯‘æ—¶è®¡ç®—
int c {9};              // é å¸¸é‡è¡¨è¾¾å¼
const int d {c};        // é å¸¸é‡è¡¨è¾¾å¼
const double b {10.0};  // é å¸¸é‡è¡¨è¾¾å¼
#+end_src

[fn:2]
#+begin_src cpp
// auto å€ŸåŠ© å­—é¢é‡åç¼€ æ¨å¯¼
auto s0 { "haha" };  // æ¨å¯¼ä¸º const char*
auto s1 { "goo"s };  // "goo"s æ˜¯ std::string å­—é¢é‡, s1 è¢«æ¨å¯¼ä¸º std::string
auto s2 { "moo"sv }; // "moo"sv æ˜¯ std::string_view å­—é¢é‡, s2 è¢«æ¨å¯¼ä¸º std::string_view
#+end_src

[fn:3]
#+begin_src cpp
const char created[] =
    "<html>"
    "<head><title>Created</title></head>"
    "<body><h1>201 Created</h1></body>"
    "</html>";
// ç­‰ä»·äº
const char created[] = "<html><head><title>Created</title></head><body><h1>201 Created</h1></body></html>";
#+end_src

[fn:4]
#+begin_src cpp :results output :namespaces std :includes <iostream>
/* é¡¶å±‚constï¼šæ‹·è´æ—¶å¿½ç•¥ */
const int a = 10;   // é¡¶å±‚const
int b = a;          // åˆæ³•ï¼ˆå¿½ç•¥é¡¶å±‚constï¼‰

/* åº•å±‚constï¼šæ‹·è´æ—¶ä¸å¿½ç•¥ */
const int* p = &a;  // åº•å±‚constï¼ˆæŒ‡é’ˆæŒ‡å‘å¸¸é‡ï¼‰
// int* q = p;      // FIXME é”™è¯¯ï¼ˆä¸èƒ½å¿½ç•¥åº•å±‚constï¼‰
const int* r = p;   // åˆæ³•ï¼ˆç›®æ ‡ä¹Ÿæœ‰åº•å±‚constï¼‰
#+end_src

[fn:5]
#+begin_src cpp :results output :namespaces std :includes <iostream>
// è¿”å› éconstexprå€¼ çš„å‡½æ•°æ˜¯ éconstexprçš„
int five() {
    return 5;
}

int main() {
    constexpr double gravity { 9.8 }; // ok: 9.8 æ˜¯å¸¸é‡è¡¨è¾¾å¼
    constexpr int sum { 4 + 5 };      // ok: 4 + 5 æ˜¯å¸¸é‡è¡¨è¾¾å¼
    constexpr int something { sum };  // ok: sum æ˜¯å¸¸é‡è¡¨è¾¾å¼
    std::cout << "Enter your age: ";
    int age{};
    std::cin >> age;
    constexpr int myAge { age };      // FIXME age ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼
    constexpr int f { five() };       // FIXME five() çš„è¿”å›å€¼ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼
 }
 #+end_src

[fn:6]
#+begin_src cpp
// ç”±äºå†å²åŸå› ï¼Œç”¨ å¸¸é‡è¡¨è¾¾å¼ åˆå§‹åŒ–çš„ const int æ˜¯å¸¸é‡è¡¨è¾¾å¼
const int a{b};          // ä¸å¥½åˆ¤æ–­aæ˜¯å¦ä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼Œå¾—çœ‹bæ˜¯ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼
const int c{func()};     // ä¸å¥½åˆ¤æ–­cæ˜¯å¦ä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼Œå¾—çœ‹func()æ˜¯å¦ä¸ºå¸¸é‡è¡¨è¾¾å¼
// NOTE æœ‰æ²¡æœ‰è®©ç¼–è¯‘å™¨æ¥æ›¿æˆ‘ä»¬åˆ¤æ–­çš„æ–¹æ³•å‘¢ï¼Ÿæœ‰ï¼ä½¿ç”¨ constexpr
constexpr int a{b};      // è‹¥aä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œåˆ™æŠ¥é”™
#+end_src

[fn:7]
#+begin_src cpp :results output :namespaces std :includes <iostream>
constexpr int greater(int x, int y) {
    return (x > y ? x : y);
}

int main() {
    std::cout << greater(5, 6) << '\n'; // greater(5, 6) å¯èƒ½åœ¨ç¼–è¯‘æ—¶ æˆ– è¿è¡Œæ—¶è®¡ç®—
    constexpr int g { greater(5, 6) };  // greater(5, 6) æ­¤å¤„ä¸º å¸¸é‡è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ï¼Œå› æ­¤åœ¨ç¼–è¯‘æ—¶è®¡ç®—
    std::cout << g << '\n';             // prints 6
}
#+end_src
