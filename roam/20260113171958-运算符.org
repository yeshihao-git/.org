:PROPERTIES:
:ID:       bb495949-bc17-4b14-8ed8-9510fe0981e7
:END:
#+title: è¿ç®—ç¬¦
#+filetags: cpp

* è¿ç®—ç¬¦
- è¿ç®—ç¬¦ :: å…·æœ‰ç‰¹å®šè¯­æ³•æ ¼å¼ã€è¯­ä¹‰çš„ç¬¦å·


** ä¸‹æ ‡è¿ç®—ç¬¦
:PROPERTIES:
:ID:       57f3a847-edad-457c-9f86-715a939e3e55
:END:
- ä¸‹æ ‡è¿ç®—ç¬¦ :: =operator[]= ï¼Œ
  1. é‡è½½åä½¿ç±»å¯¹è±¡èƒ½åƒæ•°ç»„ä¸€æ ·é€šè¿‡ =[]= è¯­æ³• è®¿é—®å†…éƒ¨å…ƒç´ 
  2. ä¸‹æ ‡è¿ç®—ç¬¦è¿”å›çš„æ˜¯[[id:1f772bce-0f88-46a2-ab44-c9bf04b30653][å¼•ç”¨]]
#+begin_src cpp
int arr[10] = {1,2,3,4,5,6,7,8,9,0};
int &p = arr[3];
#+end_src


** é€—å·è¿ç®—ç¬¦
- é€—å·è¿ç®—ç¬¦ :: ä»å·¦åˆ°å³è®¡ç®—ï¼Œè¿”å›æœ€å³è¾¹çš„è®¡ç®—ç»“æœ
#+begin_src cpp
int a = 1, b = 2;
int z;
z = (a, b);       // è®¡ç®— aï¼Œå†è®¡ç®— bï¼Œå°† b çš„å€¼èµ‹ç»™ z
z = a, b;         // è®¡ç®— aï¼Œå°† a å€¼èµ‹ç»™ z ï¼Œå†è®¡ç®— b
for (int c = 3, d = 4; ...; ...) {...}
#+end_src


** èµ‹å€¼è¿ç®—ç¬¦
:PROPERTIES:
:ID:       017397f9-efa0-45fb-b6bd-3fe3df1fd589
:END:
- èµ‹å€¼è¿ç®—ç¬¦ :: =operator== å°†ä¸€ä¸ªå¯¹è±¡çš„å†…å®¹èµ‹å€¼ç»™å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ†ä¸ºï¼šæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦
  1. èµ‹å€¼è¡¨è¾¾å¼çš„è¿”å›[[id:1f772bce-0f88-46a2-ab44-c9bf04b30653][å¼•ç”¨]]ï¼Œ *æé«˜æ•ˆç‡*
  2. æ”¯æŒ *é“¾å¼è¡¨è¾¾å¼*
#+begin_src cpp
int a = 3, b = 4;
decltype(a = b) d = a; // NOTE è¿”å›å¼•ç”¨ï¼šdçš„ç±»å‹ä¸ºint &ï¼Œå€¼ä¸º3
a = b = 1;             // NOTE æ”¯æŒé“¾å¼è¡¨è¾¾å¼ï¼šç­‰ä»·äº a = (b = 1)ï¼Œå°† b=1 çš„è¿”å›å€¼èµ‹ç»™ a

// NOTE è¿”å›å¼•ç”¨ï¼Œæé«˜æ•ˆç‡
Obj a, b;
a = b = c; // è‹¥éå¼•ç”¨ï¼Œåˆ™b=cçš„ç»“æœæ˜¯æ‹·è´å¤åˆ¶åˆ°è¿”å›å€¼ï¼Œå†èµ‹ç»™a
           // è‹¥ä¸ºå¼•ç”¨ï¼Œåˆ™è¿”å›å€¼ç›´æ¥å¼•ç”¨b=cçš„ç»“æœ
#+end_src




*** æ‹·è´èµ‹å€¼è¿ç®—ç¬¦
:PROPERTIES:
:ID:       6ac8d18c-f96c-489c-9da6-885f952f5491
:END:
- æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ :: =operator== ï¼Œæ›´æ–°ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡ï¼ˆå¯¹è±¡å·²åˆ›å»ºï¼Œç”¨å¦ä¸€ä¸ªå¯¹è±¡æ¥èµ‹å€¼ï¼‰
  1. *æ£€æŸ¥å¹¶å¤„ç†è‡ªèµ‹å€¼* ï¼šèµ‹å€¼éœ€è¦åˆ é™¤åŸå¯¹è±¡ï¼Œå†å°†å¦ä¸€ä¸ªå¯¹è±¡èµ‹å€¼è¿‡æ¥ï¼Œè‹¥æ˜¯è‡ªèµ‹å€¼ï¼Œä¼šåˆ é™¤è‡ªå·± [fn:4]
#+name: æ‹·è´èµ‹å€¼
#+begin_src cpp
STU stu1;        // é»˜è®¤æ„é€ 
STU stu2;
stu2 = stu1;     // NOTE è°ƒç”¨ æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼ˆstu2å·²å­˜åœ¨ï¼‰
#+end_src

#+name: æ‹·è´æ„é€ 
#+begin_src cpp
STU stu1;        // é»˜è®¤æ„é€ 
STU stu2 = stu1; // è°ƒç”¨ æ‹·è´æ„é€ ï¼ˆstu2ä¸å­˜åœ¨ï¼‰
#+end_src


** è¿ç®—ç¬¦é‡è½½
:PROPERTIES:
:ID:       2fd91938-ef3f-48fb-b2b6-f34409fb9cad
:END:
- è¿ç®—ç¬¦é‡è½½ :: =operator<è¿ç®—ç¬¦>()= ï¼Œç”¨äºä¸º[[id:d63526f2-db09-4c79-8a1a-57d6a7d82ec9][ç±»]]é‡æ–°å®šä¹‰è¿ç®—ç¬¦ï¼ˆegï¼š+ã€-ã€==ã€<<ï¼‰ï¼Œä½¿ç±»èƒ½åƒ[[id:59279fc7-7896-47f4-908d-25e78cfc2d54][åŸºæœ¬æ•°æ®ç±»å‹]]ä¸€æ ·ä½¿ç”¨è¿ç®—ç¬¦è¿›è¡Œæ“ä½œ
  1. *æœ¬è´¨* ï¼š[[id:a545a441-471f-45d4-8a7b-30767486357a][å‡½æ•°é‡è½½]]ï¼ˆæ ¹æ® æ“ä½œæ•°ç±»å‹ï¼‰
  2. ğŸ”¥ è¿ç®—ç¬¦é‡è½½ éœ€è¦è‡³å°‘ä¸€ä¸ªæ“ä½œæ•°æ˜¯[[id:7178949d-e6a3-4272-90ad-7d99dd56656e][ç”¨æˆ·å®šä¹‰ç±»å‹]] [fn:1]
  3. æ“ä½œæ•°é¡ºåºä¸åŒ æˆ– æ“ä½œç¬¦ä¹‹é—´æœ‰å…³è”ï¼Œå¯ä»¥ä½¿ç”¨ *å·²å®ç°çš„è¿ç®—ç¬¦æ¥å®ç°* [fn:2]
  4. è¿ç®—ç¬¦é‡è½½ æœ‰å®ç°æ–¹å¼ï¼š
     1) [[id:b0e102a4-a5e7-4634-810c-138d69e1a8ca][è¿ç®—ç¬¦é‡è½½å®ç°ï¼šæˆå‘˜å‡½æ•°]]
     2) [[id:dcc55e7b-f23e-4a8d-91e9-d322e8bac8aa][è¿ç®—ç¬¦é‡è½½å®ç°ï¼šéæˆå‘˜å‡½æ•°]]


*** è¿ç®—ç¬¦é‡è½½å®ç°ï¼šæˆå‘˜å‡½æ•°
:PROPERTIES:
:ID:       b0e102a4-a5e7-4634-810c-138d69e1a8ca
:END:
æˆå‘˜å‡½æ•°ï¼š
1. é€‚åˆ *å·¦æ“ä½œæ•° æ˜¯ ç±»å¯¹è±¡* çš„æƒ…å†µï¼ˆå·¦æ“ä½œæ•° æ˜¯ éšå¼çš„ =*this= å¯¹è±¡ï¼‰ [fn:3]

å“ªäº›è¿ç®—ç¬¦é€‚åˆï¼Ÿ
1. ï¼ˆ *å¿…é¡»* ï¼‰èµ‹å€¼ === ã€ä¸‹æ ‡ =[]= ã€å‡½æ•°è°ƒç”¨ =()= ã€æˆå‘˜é€‰æ‹© =->= ã€ç±»å‹è½¬æ¢è¿ç®—ç¬¦
2. æ”¹å˜å¯¹è±¡çŠ¶æ€çš„ï¼š =+== ï¼Œ =-== ï¼Œ =++= ï¼Œ =--=


**** ç±»å‹è½¬æ¢è¿ç®—ç¬¦
:PROPERTIES:
:ID:       7e5f347d-1bf6-4d12-ab58-cec024b09c8e
:ROAM_ALIASES: ç±»å‹è½¬æ¢è¿ç®—ç¬¦é‡è½½
:END:
- ç±»å‹è½¬æ¢è¿ç®—ç¬¦ :: =operator<type>= ç±» -> åŸºæœ¬ç±»å‹ ï¼ˆéšå¼è½¬æ¢ï¼‰

*æœ€ä½³å®è·µ*
ä¼˜å…ˆä½¿ç”¨ [[id:a024d9ab-e3be-45a9-8cbd-1eb292074833][è½¬æ¢æ„é€ å‡½æ•°]]

=operator<type>()= ä¹¦å†™æ–¹å¼ï¼š[fn:5]
1. å¿…é¡» éstaticï¼Œåº”è¯¥ constï¼ˆä»¥ä¾¿ç”¨äº å¸¸é‡å¯¹è±¡ï¼‰
2. æ—  å‡½å‚
3. æ—  è¿”å›
4. ä¸€èˆ¬è®¾ç½®ä¸º [[id:2f9e4a5c-e6fe-4006-a6df-0bbd7fce0ded][explicit]] é˜²æ­¢éšå¼è½¬æ¢


**** è‡ªå¢è¿ç®—ç¬¦
:PROPERTIES:
:ID:       8d07ddaa-112f-419f-bfed-4fe2142ba14c
:END:
- è‡ªå¢è¿ç®—ç¬¦ :: operator++
1. å‰ç½®++ï¼š =operator++()=
2. åç½®++ï¼š =operator++(int)= [fn:6]
# operator--åŒç†


*** è¿ç®—ç¬¦é‡è½½å®ç°ï¼šéæˆå‘˜å‡½æ•°
:PROPERTIES:
:ID:       dcc55e7b-f23e-4a8d-91e9-d322e8bac8aa
:END:
éæˆå‘˜å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ã€å‹å…ƒå‡½æ•°ï¼‰ï¼š
1. é€‚åˆ *å·¦æ“ä½œæ•° ä¸æ˜¯ç±»å¯¹è±¡* çš„æƒ…å†µ
2. è®¿é—®ç±»å†… private/protected æˆå‘˜ ä½¿ç”¨ ç±»å…¬å…±æ¥å£ æˆ– å‹å…ƒå‡½æ•°[fn:7]

å“ªäº›è¿ç®—ç¬¦é€‚åˆï¼Ÿ
1. ï¼ˆ *å¿…é¡»* ï¼‰å·¦æ“ä½œæ•°æ˜¯æµå¯¹è±¡ï¼š =<<= ï¼Œ =>>= [fn:8]
2. å…·æœ‰å¯¹ç§°æ€§ï¼Œæ”¯æŒéšå¼ç±»å‹è£…æ¢ï¼š =+= ï¼Œ =-= ï¼Œ ==== ï¼Œ =!==




* Footnotes

[fn:1]
#+begin_src cpp
operator+(int, Mystring) // ok
operator+(int, double)   // FIXME
#+end_src

[fn:2]
#+begin_src cpp
// NOTE å‚æ•°é¡ºåºä¸åŒ
Cents operator+(const Cents& c1, int value);
Cents operator+(int value, const Cents& c1) { return c1 + value; } // è°ƒç”¨ operator+(const Cents& c1, int value);

// NOTE æ“ä½œç¬¦ä¹‹é—´æœ‰å…³è”
bool operator== (const Cents& c1, const Cents& c2) { return c1.m_cents == c2.m_cents; }
bool operator!= (const Cents& c1, const Cents& c2) { return !(operator==(c1, c2)); }
bool operator< (const Cents& c1, const Cents& c2) { return c1.m_cents < c2.m_cents; }
bool operator> (const Cents& c1, const Cents& c2) { return operator<(c2, c1); }
bool operator<= (const Cents& c1, const Cents& c2) { return !(operator>(c1, c2)); }
bool operator>= (const Cents& c1, const Cents& c2) { return !(operator<(c1, c2)); }
#+end_src

[fn:3]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Cents {
private:
    int m_cents {};
public:
    Cents(int cents) : m_cents { cents } { }
    Cents operator+(int value) const;        // NOTE å·¦æ“ä½œæ•° æ˜¯ éšå¼çš„*thisï¼Œæˆå‘˜å‡½æ•°é‡è½½ï¼šCents + int
    int getCents() const { return m_cents; }
};

Cents Cents::operator+ (int value) const {
    return Cents { m_cents + value };
}

int main() {
  const Cents cents1 { 6 };
  const Cents cents2 { cents1 + 2 };
  std::cout << "I have " << cents2.getCents() << " cents.\n";
}
#+end_src

#+RESULTS:
: I have 8 cents.

[fn:4]
#+begin_src cpp
MyString& MyString::operator= (const MyString& str) {
	// NOTE 1. è‡ªèµ‹å€¼å¤„ç†ï¼šç›´æ¥è¿”å›
  if (this == &str)
    return *this;

  // 2. åˆ é™¤è‡ªå·±çš„å€¼
  if (m_data) delete[] m_data;

  m_length = str.m_length;
  m_data = nullptr;

  // 3. å¤åˆ¶ä»–äººçš„å€¼
  if (m_length)
    m_data = new char[static_cast<std::size_t>(str.m_length)];

  std::copy_n(str.m_data, m_length, m_data);

  // 4. return the existing object so we can chain this operator
  return *this;
}
#+end_src

[fn:5]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Cents {
private:
    int m_cents{};
public:
    Cents(int cents=0) : m_cents{ cents } { }

    // NOTE intç±»å‹è½¬æ¢è¿ç®—ç¬¦é‡è½½ï¼šéstaticï¼Œä¸ºconstï¼Œæ— å‡½å‚ï¼Œæ— è¿”å›
    operator int() const { return m_cents; }

    int getCents() const { return m_cents; }
    void setCents(int cents) { m_cents = cents; }
};

// è¾“å…¥ Centsç±»å¯¹è±¡ -> é‡è½½intç±»å‹è½¬æ¢
void printInt(int value) { std::cout << value; }

int main() {
    Cents cents{ 7 };
    printInt(cents);
    std::cout << '\n';
}
#+end_src

[fn:6]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Digit {
private:
    int m_digit{};
public:
    Digit(int digit=0) : m_digit{digit} { }
    // NOTE å‰ç½®++/--
    Digit& operator++();
    Digit& operator--();
    // NOTE åç½®++/--
    Digit operator++(int);
    Digit operator--(int);

    friend std::ostream& operator<< (std::ostream& out, const Digit& d);
};

Digit& Digit::operator++() {
    if (m_digit == 9)
        m_digit = 0;
    else
        ++m_digit;

    return *this;
}

Digit& Digit::operator--() {
    if (m_digit == 0)
        m_digit = 9;
    else
        --m_digit;

    return *this;
}

// NOTE åç½®å®ç°æ–¹å¼
Digit Digit::operator++(int) {
    Digit temp{*this};

    ++(*this); // è°ƒç”¨ å‰ç½®++

    // è¿”å›ä¸´æ—¶å¯¹è±¡
    return temp;
}

Digit Digit::operator--(int) {
    Digit temp{*this};

    --(*this);

    return temp;
}

std::ostream& operator<< (std::ostream& out, const Digit& d) {
	out << d.m_digit;
	return out;
}

int main() {
    Digit digit { 5 };

    std::cout << digit;
    std::cout << ++digit; // calls Digit::operator++();
    std::cout << digit++; // calls Digit::operator++(int);
    std::cout << digit;
    std::cout << --digit; // calls Digit::operator--();
    std::cout << digit--; // calls Digit::operator--(int);
    std::cout << digit;
}
#+end_src

#+RESULTS:
: 5667665

[fn:7]
#+name: ä½¿ç”¨ç±»æä¾›çš„å…¬å…±æ¥å£è®¿é—®ç§æœ‰æˆå‘˜
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Cents {
private:
  int m_cents{};
public:
  Cents(int cents) : m_cents{ cents } { }
  int getCents() const { return m_cents; }
};

// NOTE æ™®é€šå‡½æ•°ï¼šä½¿ç”¨ç±»æä¾›çš„å…¬å…±æ¥å£è®¿é—®ç§æœ‰æˆå‘˜
Cents operator+(const Cents& c1, const Cents& c2) {
  return Cents{ c1.getCents() + c2.getCents() };
}

int main() {
  Cents cents1{ 6 };
  Cents cents2{ 8 };
  Cents centsSum{ cents1 + cents2 };
  std::cout << "I have " << centsSum.getCents() << " cents.\n";
}
#+end_src

#+RESULTS:
: I have 14 cents.

#+name: ä½¿ç”¨å‹å…ƒå‡½æ•°è®¿é—®ç§æœ‰æˆå‘˜
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Cents {
private:
	int m_cents {};
public:
  Cents(int cents) : m_cents{ cents } { }
  friend Cents operator+(const Cents& c1, const Cents& c2); // NOTE å‹å…ƒå‡½æ•°ï¼šç±»å¤–å®ç° Cents + Cents
  int getCents() const { return m_cents; }

  // NOTE å‹å…ƒå‡½æ•°ï¼šç±»å†…å®ç° -> ç±»å†…å®ç°ä¹Ÿå±äº ç±»çš„æˆå‘˜
  // friend Cents operator+(const Cents& c1, const Cents& c2)
	// {
	//    return Cents { c1.m_cents + c2.m_cents };
	// }
};

// å‹å…ƒå‡½æ•°ï¼šç±»å¤–å®ç°
Cents operator+(const Cents& c1, const Cents& c2) {
	return c1.m_cents + c2.m_cents;
}

int main() {
	Cents cents1{ 6 };
	Cents cents2{ 8 };
	Cents centsSum{ cents1 + cents2 };
	std::cout << "I have " << centsSum.getCents() << " cents.\n";
}
#+end_src

#+RESULTS:
: I have 14 cents.

[fn:8]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Point
{
private:
    double m_x{};
    double m_y{};
    double m_z{};

public:
    Point(double x=0.0, double y=0.0, double z=0.0)
      : m_x{x}, m_y{y}, m_z{z}
    {
    }

    friend std::ostream& operator<< (std::ostream& out, const Point& point);
};

std::ostream& operator<< (std::ostream& out, const Point& point)
{
    out << "Point(" << point.m_x << ", " << point.m_y << ", " << point.m_z << ')';
    return out; // è¿”å› std::ostream æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é“¾å¼è°ƒç”¨
}

int main()
{
    const Point point1 { 2.0, 3.0, 4.0 };

    std::cout << point1 << '\n';

    return 0;
}
#+end_src

[fn:9]
#+begin_src cpp :results output :namespaces std :includes <iostream>
template <typename T>
T average(const T* myArray, int numValues)
{
    T sum { 0 };
    for (int count { 0 }; count < numValues; ++count)
        sum += myArray[count];

    sum /= numValues;
    return sum;
}

class Cents
{
private:
    int m_cents {};
public:
    Cents(int cents)
        : m_cents { cents }
    {
    }

    friend std::ostream& operator<< (std::ostream& out, const Cents& cents)
    {
        out << cents.m_cents << " cents ";
        return out;
    }

    Cents& operator+= (const Cents &cents)
    {
        m_cents += cents.m_cents;
        return *this;
    }

    Cents& operator/= (int x)
    {
        m_cents /= x;
        return *this;
    }
};

int main()
{
    Cents centsArray[] { Cents { 5 }, Cents { 10 }, Cents { 15 }, Cents { 14 } };
    std::cout << average(centsArray, 4) << '\n';

    return 0;
}
#+end_src

[fn:10]
#+begin_src cpp :results output :namespaces std :includes <iostream>
template <typename T>
T average(const T* myArray, int numValues)
{
    T sum { 0 };
    for (int count { 0 }; count < numValues; ++count)
        sum += myArray[count]; // NOTE æ¨¡æ¿å®ä¾‹åŒ–ï¼Œéœ€è¦å®ç° operator+=

    sum /= numValues;          // NOTE æ¨¡æ¿å®ä¾‹åŒ–ï¼Œéœ€è¦å®ç° operator/=
    return sum;
}

class Cents
{
private:
    int m_cents {};
public:
    Cents(int cents)
        : m_cents { cents }
    {
    }

    friend std::ostream& operator<< (std::ostream& out, const Cents& cents)
    {
        out << cents.m_cents << " cents ";
        return out;
    }

    Cents& operator+= (const Cents &cents)
    {
        m_cents += cents.m_cents;
        return *this;
    }

    Cents& operator/= (int x)
    {
        m_cents /= x;
        return *this;
    }
};

int main()
{
    Cents centsArray[] { Cents { 5 }, Cents { 10 }, Cents { 15 }, Cents { 14 } };
    // NOTE æ¨¡æ¿å®ä¾‹åŒ–ï¼Œéœ€è¦å®ç° operator<<
    std::cout << average(centsArray, 4) << '\n';

    return 0;
}
#+end_src

[fn:11]
#+name: Cents.h
#+begin_src cpp :results output :namespaces std :includes <iostream>
#ifndef CENTS_H
#define CENTS_H

class Cents
{
private:
  int m_cents{};
public:
  Cents(int cents) : m_cents{ cents } { }

  int getCents() const { return m_cents; }
};
// æä¾›å‡½æ•°å£°æ˜
Cents operator+(const Cents& c1, const Cents& c2);

#endif
#+end_src

#+name: Cents.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
#include "Cents.h"

Cents operator+(const Cents& c1, const Cents& c2)
{
  return { c1.getCents() + c2.getCents() };
}
#+end_src

#+name: main.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
#include "Cents.h"

int main()
{
  Cents cents1{ 6 };
  Cents cents2{ 8 };
  Cents centsSum{ cents1 + cents2 }; // æ²¡æœ‰ Cents.h ä¸­çš„å‡½æ•°å£°æ˜, è¿™ä¸ªä¼šç¼–è¯‘é”™è¯¯
  std::cout << "I have " << centsSum.getCents() << " cents.\n";

  return 0;
}
#+end_src
