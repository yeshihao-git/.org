:PROPERTIES:
:ID:       3aa872a4-290a-4fc8-8e37-add919e44822
:END:
#+title: gcc
#+filetags: tools

* gcc
- gcc :: 编译器集合（包含：gcc、g++、gfortran等）
  1. =gcc= 用于编译 C， *不会自动链接 C++库* ； =g++= 用于编译 C++，会自动链接 C++库

** 快速开始
gcc 通常结合 [[id:a9d0b4ef-0f28-4bba-b882-83e96a9f2bc2][pkg-config]] 使用，通过 pkg-config 自动获取包含头文件路径参数、链接库文件路径参数，示例：[fn:1]

#+name: 现代方法 - 结合 pkg-config 进行编译
#+begin_example bash
g++ -g -o main main.cpp $(pkg-config --cflags --libs opencv4)
#+end_example
|----------------------+--------------------------------------------------------------------|
| 参数                 | 说明                                                               |
|----------------------+--------------------------------------------------------------------|
| -o <output> <source> | 输出文件                                                           |
| -O<level>            | 设置优化级别：-O0无优化，-O1、-O2、-O3优化级别递增。推荐优化选项O2 |
| -I<dir>              | 头文件搜索路径                                                     |
| -L<dir>              | 库文件搜索路径                                                     |
| -l<library>          | 链接指定的库                                                       |
| -g                   | 生成调试信息                                                       |
| -std=<standard>      | 指定语言标准                                                       |
| -fPIC                | 生成位置无关编码（用于动态库）                                     |
| -shared              | 指定生成动态库                                                     |
| -c                   | 编译生成.o文件，不链接                                             |
| -v                   | 显示编译器版本、详细编译过程                                       |
| -w                   | 编译时，不显示任何警告信息                                         |
| -Wall                | 编译时，显示所有警告信息                                           |
| -DNDEBUG             | 预处理器禁用代码中的调试行为(如assert())                           |
|----------------------+--------------------------------------------------------------------|

** 编译流程
:PROPERTIES:
:ID:       5c438b58-e8df-43bd-ad72-96f0b2b4d3e5
:END:
源代码 -> [[id:a48d200f-d7ad-41ad-8592-a7ff528378ea][预处理器]] =.cpp文件= (翻译单元) -> 编译成 =.o文件= (机器指令) -> [[id:04b223e7-c9e1-4c4b-a75d-733e9f16c972][链接器]](.o文件、[[id:6012c06e-c6c5-4001-a287-dfe05404724d][库文件]]) -> 可执行文件(elf、exe)
见：[[id:3ea7cd10-aa1a-4da9-bced-284f2b510732][图:编译、链接]]
- 翻译单元 :: 源文件 经预处理（#include 展开、宏替换）后生成的完整代码单元


** 附件
*** 图:编译、链接 :ATTACH:
:PROPERTIES:
:ID:       3ea7cd10-aa1a-4da9-bced-284f2b510732
:END:
#+name: 编译
[[attachment:_20250804_172137screenshot.png]]
#+name: 链接
[[attachment:_20250804_172211screenshot.png]]


* pkg-config
:PROPERTIES:
:ID:       a9d0b4ef-0f28-4bba-b882-83e96a9f2bc2
:END:
用于查询包信息，需要包提供 *.pc文件*
|----------------------+------------|
| 命令行参数           | 作用       |
|----------------------+------------|
| --list-package-names | 列出所有包 |
| --modversion <包名>  | 包版本号   |
|----------------------+------------|

*.pc文件*
描述包的 元数据，包括：
1. 头文件路径（-I参数）
2. 库文件路径（-L参数）
3. 库名称    （-l参数）
4. 版本号
5. 依赖
6. ...

- 元数据 :: 描述数据的数据（说明数据的属性、结构、来源等信息）

*如何查找.pc文件所在的路径？*
|-----------------+----------------------+---------------------------|
| 环境变量        | 路径                 | 作用                      |
|-----------------+----------------------+---------------------------|
| PKG_CONFIG_PATH |                      | .pc搜索路径（用户自定义） |
|                 | /usr/lib/pkgconfig   | .pc搜索路径（系统默认）   |
|                 | /usr/share/pkgconfig | .pc搜索路径（系统默认）   |
|-----------------+----------------------+---------------------------|


* Footnotes

[fn:1]
#+begin_example bash
# 链接库参数
❯ pkg-config --libs opencv4
-lopencv_gapi -lopencv_stitching -lopencv_alphamat -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_cvv -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hdf -lopencv_hfs -lopencv_img_hash -lopencv_intensity_transform -lopencv_line_descriptor -lopencv_mcc -lopencv_quality -lopencv_rapid -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_signal -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_highgui -lopencv_datasets -lopencv_text -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_viz -lopencv_wechat_qrcode -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_dnn -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core

# 包含头文件路径参数
❯ pkg-config --cflags opencv4
-I/usr/include/opencv4
#+end_example
