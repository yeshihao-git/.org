:PROPERTIES:
:ID:       604d5ad5-f060-4504-b407-933fc82aeb7e
:END:
#+title: 命名空间
#+filetags: cpp

* 命名空间
- 命名空间 :: 一种作用域封装机制，避免命名冲突
  1. 命名空间 中 *只能有[[id:1752c1cb-3fd8-4272-96c9-fa73e14a7d3c][声明、定义]]* 不能有执行语句
  2. 全局作用域 属于 *隐式的全局命名空间* ，不能有执行语句 [fn:1]
  3. 分文件编写的 [[id:1752c1cb-3fd8-4272-96c9-fa73e14a7d3c][声明、定义]] 要在一个 命名空间 中
  4. =::<名称>= （无前缀作用域解析运算符）访问全局命名空间的名称 [fn:2]
  5. 命名空间可以 *嵌套*

*语法*
#+begin_example cpp
namespace <名称> {}                                   // 定义命名空间
<命名空间>::<标识符>                                  // 访问命名空间中的标识符
using namespace <命名空间> / using <命名空间>::<名称> // 导入命名空间中的标识符
namespace <别名> = <命名空间>                         // 给命名空间起别名

#+end_example

*分类*
1. 标准命名空间（std）
2. 全局命名空间
3. 用户自定义命名空间
4. [[id:7a5f6a69-11b7-4830-ac35-b1b9f82e8c47][匿名命名空间]]
5. [[id:9d01ee48-d2fd-4459-b0fb-851bb7d966b4][内联命名空间]]

** 匿名命名空间
:PROPERTIES:
:ID:       7a5f6a69-11b7-4830-ac35-b1b9f82e8c47
:END:
- 匿名命名空间 :: 没有名字的命名空间，
  1. 内部成员的标识符属于父命名空间，可直接调用
  2. 仅在 *当前翻译单元可见* ，具有 [[id:ec823c59-99d9-4818-a3a3-be1e01b55b3c][内部链接性]] [fn:3]
#+begin_example cpp
namespace { ... }
#+end_example

** 内联命名空间
:PROPERTIES:
:ID:       9d01ee48-d2fd-4459-b0fb-851bb7d966b4
:END:
- 内联命名空间 :: （cpp11）用于 *版本控制* [fn:4]
  1. 内部成员的标识符属于父命名空间，可直接调用，默认使用内联命名空间中的成员
  2. 不具有 [[id:ec823c59-99d9-4818-a3a3-be1e01b55b3c][内部链接性]]
#+begin_example cpp
inline namespace <名称> { ...  }
#+end_example

* Footnotes

[fn:1]
#+begin_src cpp :results output :namespaces std :includes <iostream>
#include <iostream> // 导入 std::cout 到全局命名空间中

// 下列语句在 全局命名空间 中
void foo();    // ok
int x;         // compiles but strongly discouraged: non-const global variable definition (without initializer)
int y { 5 };   // compiles but strongly discouraged: non-const global variable definition (with initializer)
x = 5;         // FIXME: 命名空间中不允许有 执行语句

int main() {   // ok
    return 0;
}

void goo();    // ok
#+end_src

[fn:2]
#+begin_src cpp
f1(){}
namespace N1 {
  void f1(){}
  void f2(){
    f1();
    ::f1();      // 访问全局命名空间的 f1()
  }
}
#+end_src

[fn:3]
#+begin_src cpp :results output :namespaces std :includes <iostream>
namespace {                 // 匿名命名空间
    void doSomething()  {   // 只能在当前文件访问（等价于 static 修饰）
        std::cout << "v1\n";
    }
}

int main() {
    doSomething();          // 无需命名空间前缀就能调用 doSomething()
}
#+end_src

[fn:4]
#+begin_src cpp :results output :namespaces std :includes <iostream>
inline namespace V1 {  // 内联命名空间 V1
    void doSomething() {
        std::cout << "V1\n";
    }
}

namespace V2 {         // 普通命名空间 V2
    void doSomething() {
        std::cout << "V2\n";
    }
}

int main() {
    V1::doSomething(); // 调用 V1版本 doSomething()
    V2::doSomething(); // 调用 V2版本 doSomething()
    doSomething();     // 默认调用 V1版本（内联版本）
}
#+end_src
