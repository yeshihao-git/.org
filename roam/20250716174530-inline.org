:PROPERTIES:
:ID:       3e85303c-39c7-4ac3-9d88-a9513d036477
:END:
#+title: inline
#+filetags: cpp

* inline
- inline :: 内联关键字
  1. 建议编译器将[[id:599c0029-f742-474f-8c86-1c6521201900][函数]]嵌入到调用处（没有函数调用开销）
  2. 允许[[id:599c0029-f742-474f-8c86-1c6521201900][函数]]/[[id:4276f9fb-4b68-4c73-bd8f-8a7c1e5f82a9][变量]]在多个翻译单元重复定义而不违反[[id:9e748196-1cab-4aed-9841-10d89bfff8b4][单一定义规则]]（最终由[[id:04b223e7-c9e1-4c4b-a75d-733e9f16c972][链接器]]去重）[fn:1]
     （使用条件：定义必须完全相同、编译器在使用处必须看到完整定义）
  3. （cpp17）inline变量具有[[id:eeb84412-f94b-4f43-b67a-d1063fb7e106][外部链接性]]

  *why* ？我们有较短的几行代码需要经常使用，考虑用函数封装（好处在于模块化，更容易使用和管理），但函数调用有开销且需要频繁调用，因此使用内联函数

* Footnotes

[fn:1]
#+name: math.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
inline double pi() { return 3.14159; } // pi() 第一定义

double circumference(double radius) { // circumference(double) 定义
    return 2.0 * pi() * radius;
}
#+end_src

#+name: main.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
double circumference(double radius);   // circumference(double) 前向声明

inline double pi() { return 3.14159; } // pi() 第二定义，因为是 inline函数，因此链接器会帮我们去重，不会违反 单一定义规则

int main() {
    std::cout << pi() << '\n';
    std::cout << circumference(2.0) << '\n';
}
#+end_src
