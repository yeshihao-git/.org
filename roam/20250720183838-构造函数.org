:PROPERTIES:
:ID:       50402d44-720e-42ed-b590-2b18d219acc1
:END:
#+title: æ„é€ å‡½æ•°
#+filetags: cpp

* æ„é€ å‡½æ•°
- æ„é€ å‡½æ•° :: ç‰¹æ®Šçš„[[id:3a39bdbf-179e-4dd8-aaf9-3aeb1d0c3863][æˆå‘˜å‡½æ•°]]ï¼Œç”¨äº *åˆå§‹åŒ–ç±»å¯¹è±¡*
  1. åç§°åŒç±»åä¸”æ— è¿”å›ç±»å‹
  2. *æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨* ç”¨äºæˆå‘˜åˆå§‹åŒ–
     1) =const= ã€ =å¼•ç”¨= æˆå‘˜åªèƒ½åœ¨æ­¤åˆå§‹åŒ–
     2) *åˆå§‹åŒ–é¡ºåº* ï¼šæŒ‰ç±»ä¸­å®šä¹‰çš„é¡ºåºåˆå§‹åŒ– [fn:1]
  3. *æ„é€ å‡½æ•°ä½“* ç”¨äºå…¶ä»–ä»»åŠ¡ï¼ˆegï¼šæ‰“å¼€æ–‡ä»¶ã€æ•°æ®åº“...ï¼‰
  4. ğŸ”¥ *æ‰§è¡Œé¡ºåº* ï¼šé»˜è®¤åˆå§‹åŒ–å™¨/é»˜è®¤åˆå§‹åŒ– -> æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ -> æ„é€ å‡½æ•°ä½“[fn:2]
  5. *å†…å­˜åˆ†é…* ï¼šç¼–è¯‘å™¨ä¸ºå¯¹è±¡ åˆ†é…å†…å­˜ -> ç„¶ååœ¨ä¸ºåˆå§‹åŒ–çš„å¯¹è±¡ä¸Š è°ƒç”¨ æ„é€ å‡½æ•° åˆå§‹åŒ–

*ç±»åˆ«*
1. ç”¨æˆ·å®šä¹‰çš„æ„é€ å‡½æ•°
2. [[id:705ffd8d-ce2d-4a2f-809d-61bb83d1c2d4][é»˜è®¤æ„é€ å‡½æ•°]]
3. [[id:3a1e42bf-ed72-4d17-b1c6-72bb5315d3ce][å§”æ‰˜æ„é€ å‡½æ•°]]
4. [[id:a024d9ab-e3be-45a9-8cbd-1eb292074833][è½¬æ¢æ„é€ å‡½æ•°]]
5. [[id:828d1a9b-3ab1-4471-8906-1cf535ea8e7d][æ‹·è´æ„é€ å‡½æ•°]]
6. [[id:51145ff8-f7e2-462d-96ec-01cb9e35c2cc][ç§»åŠ¨æ„é€ å‡½æ•°]]
7. [[id:fabc592f-3ef4-4ea3-9700-abfc4300f73b][åˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•°]]


** é»˜è®¤æ„é€ å‡½æ•°
:PROPERTIES:
:ID:       705ffd8d-ce2d-4a2f-809d-61bb83d1c2d4
:END:
- é»˜è®¤æ„é€ å‡½æ•° :: ç”¨æˆ·æœªå®šä¹‰æ„é€ å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬åˆæˆ éšå¼é»˜è®¤æ„é€ å‡½æ•°ï¼ˆä¹Ÿèƒ½ ==default= æ˜¾å¼ç”Ÿæˆï¼‰
  1. *æ‰€æœ‰å‚æ•°éƒ½æœ‰é»˜è®¤å€¼* çš„æ„é€ å‡½æ•° æ˜¯ é»˜è®¤æ„é€ å‡½æ•°ï¼Œåº”é¿å…æ­§ä¹‰è°ƒç”¨ [fn:3]
  2. *ä½•æ—¶è°ƒç”¨* é»˜è®¤æ„é€ å‡½æ•°ï¼Ÿ =å€¼åˆå§‹åŒ–= å’Œ =é»˜è®¤åˆå§‹åŒ–= æ—¶ [fn:4]
  3. ç”¨æˆ·å®šä¹‰çš„é»˜è®¤æ„é€ å‡½æ•° å’Œ ï¼ˆéšå¼é»˜è®¤æ„é€ å‡½æ•° å’Œ =defaultå®šä¹‰çš„é»˜è®¤æ„é€ å‡½æ•°ï¼‰ *åˆå§‹åŒ–è¡Œä¸ºä¸ä¸€æ ·* [fn:5]
#+begin_example cpp
ç±»å() {}
ç±»å(å‚æ•°1=é»˜è®¤å€¼1, å‚æ•°2=é»˜è®¤å€¼2, ...) {}
#+end_example


** å§”æ‰˜æ„é€ å‡½æ•°
:PROPERTIES:
:ID:       3a1e42bf-ed72-4d17-b1c6-72bb5315d3ce
:END:
- å§”æ‰˜æ„é€ å‡½æ•° :: ï¼ˆcpp11ï¼‰æ„é€ å‡½æ•°çš„ *æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨* ä¸­è°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå‡å°‘é‡å¤ä»£ç 
#+begin_example cpp
ç±»å(å‚æ•°1) : ç±»å{ å€¼1, å€¼2 } { }  // å§”æ‰˜ ç±»å(å‚æ•°1, å‚æ•°2)
ç±»å(å‚æ•°1, å‚æ•°2) : æˆå‘˜1{ å‚æ•°1 }, æˆå‘˜2{ å‚æ•°2 } { }
#+end_example


** æ‹·è´æ„é€ å‡½æ•°
:PROPERTIES:
:ID:       cddd975a-e5ee-4db6-9749-dab49f962796
:END:
- æ‹·è´æ„é€ å‡½æ•° :: ç”¨ç›¸åŒç±»å‹çš„å¯¹è±¡ åˆå§‹åŒ–å¯¹è±¡
  1. ğŸ“– *é¢è¯•é¢˜* ä¸ºä»€ä¹ˆå¿…é¡»ç”¨å¼•ç”¨ï¼Ÿ é¿å…æ— é™é€’å½’ [fn:6]
  2. æ— è‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨åˆæˆ *éšå¼æ‹·è´æ„é€ å‡½æ•°* ï¼šå¯¹ ç±»æˆå‘˜ è¿›è¡Œ *æµ…æ‹·è´* ï¼ˆä¹Ÿèƒ½ç”¨ ==default= ï¼‰ï¼Œéœ€è¦ *æ·±æ‹·è´* ç±»æˆå‘˜ï¼Œéœ€è¦è‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°
  3. ä½¿ç”¨ ==delete= ç¦æ­¢æ‹·è´
#+begin_src cpp
ç±»å(const T&) {}   //  & å¿…é¡»æœ‰ï¼Œconstå¯é€‰ä½†æ˜¯å»ºè®®
#+end_src


** è½¬æ¢æ„é€ å‡½æ•°
:PROPERTIES:
:ID:       a024d9ab-e3be-45a9-8cbd-1eb292074833
:END:
- è½¬æ¢æ„é€ å‡½æ•° :: =åŸºæœ¬ç±»å‹ -> ç±»= ï¼Œå•å‚æ•°ï¼ˆæˆ– å¸¦é»˜è®¤å€¼çš„å¤šå‚æ•°ï¼‰çš„æ„é€ å‡½æ•°ï¼Œå•ä¸ªå‚æ•°ç±»å‹ *éšå¼è½¬æ¢* ä¸ºç±»ç±»å‹
  1. å¤šå‚æ•°ï¼ˆä¸å¸¦é»˜è®¤å€¼ï¼‰ä¹Ÿå¯ä»¥å‘ç”Ÿ éšå¼è½¬æ¢ï¼ˆé€šè¿‡ [[id:c794bd12-f733-4f8d-99cb-b34555506975][åˆ—è¡¨åˆå§‹åŒ–]]ï¼‰[fn:7]
  2. éšå¼è½¬æ¢ *åªèƒ½å‘ç”Ÿä¸€æ¬¡* [fn:8]
  3. *é¿å…éæœŸæœ›çš„éšå¼è½¬æ¢* ï¼Œä½¿ç”¨ [[id:2f9e4a5c-e6fe-4006-a6df-0bbd7fce0ded][explicit]]ï¼ˆæœ€ä½³å®è·µï¼‰
#+begin_example cpp
ç±»å‹(å‚æ•°1) {}
ç±»å‹(å‚æ•°1, å‚æ•°2=é»˜è®¤å€¼...) {}
#+end_example


*** explicit
:PROPERTIES:
:ID:       2f9e4a5c-e6fe-4006-a6df-0bbd7fce0ded
:END:
- explicit :: ä¿®é¥°æ„é€ å‡½æ•°ï¼Œä½¿å…¶åªèƒ½ *æ˜¾å¼è°ƒç”¨* ï¼Œé˜²æ­¢æ„æƒ³ä¸åˆ°çš„éšå¼è½¬æ¢ [fn:9]


** ç§»åŠ¨æ„é€ å‡½æ•°
:PROPERTIES:
:ID:       51145ff8-f7e2-462d-96ec-01cb9e35c2cc
:END:
- ç§»åŠ¨æ„é€ å‡½æ•° :: ï¼ˆcpp11ï¼‰å‚æ•°ä¸ºå³å€¼å¼•ç”¨çš„æ„é€ å‡½æ•°ï¼Œé€šè¿‡ â€œçªƒå–â€ æºå³å€¼å¯¹è±¡çš„èµ„æºåˆå§‹åŒ–æ–°å¯¹è±¡ï¼Œé¿å…æ‹·è´å¼€é”€
  1. å³å€¼ï¼ˆæˆ– std::move å°†å·¦å€¼è½¬å³å€¼ï¼‰åˆå§‹åŒ–å¯¹è±¡æ—¶ *è°ƒç”¨*
  2. ç¼–è¯‘å™¨åˆæˆ *éšå¼ç§»åŠ¨æ„é€ * æ¡ä»¶ï¼š
     1) æ— è‡ªå®šä¹‰ [[id:cddd975a-e5ee-4db6-9749-dab49f962796][æ‹·è´æ„é€ ]]ã€æ‹·è´èµ‹å€¼ã€ç§»åŠ¨æ„é€ ã€ç§»åŠ¨èµ‹å€¼ã€ææ„å‡½æ•°
     2) å¯ç§»åŠ¨çš„ç§»åŠ¨ï¼Œå…¶ä½™å¤åˆ¶
#+begin_example cpp
ç±»å(ç±»å&&) {}
#+end_example


** åˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•°
:PROPERTIES:
:ID:       fabc592f-3ef4-4ea3-9700-abfc4300f73b
:END:
- åˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•° :: ï¼ˆcpp11ï¼‰å‚æ•°ä¸º =std::initializer_list<T>= çš„æ„é€ å‡½æ•°ï¼Œæ”¯æŒ [[id:c794bd12-f733-4f8d-99cb-b34555506975][åˆ—è¡¨åˆå§‹åŒ–]]ï¼ˆä¼˜å…ˆçº§é«˜äºæ™®é€šå¤šå‚æ•°æ„é€ å‡½æ•°ï¼‰
#+begin_example cpp :includes <initializer_list>
ç±»å(std::initializer_list<T> list) {}

std::vector v{1,2,3}; // ç¤ºä¾‹
#+end_example


* Footnotes

[fn:1]
#+begin_src cpp :results output :namespaces std :includes <iostream> <algorithm>
class Foo {
private:
    int m_x{};
    int m_y{};

public:
    // FIXME å…ˆåˆå§‹åŒ– m_xï¼Œä½†æ˜¯ m_x ä½¿ç”¨ m_y åˆå§‹åŒ–ï¼Œå› æ­¤å‡ºé”™
    Foo(int x, int y) : m_y { std::max(x, y) }, m_x { m_y } { }

    void print() const {
        std::cout << "Foo(" << m_x << ", " << m_y << ")\n";
    }
};

int main() {
    Foo foo { 6, 7 };
    foo.print();
}
#+end_src

[fn:2]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Foo {
private:
    int m_x {};                           // 1. é»˜è®¤åˆå§‹åŒ–å™¨ (åç»­è¢« 6 è¦†ç›–)
    int m_y { 2 };                        // 1. é»˜è®¤åˆå§‹åŒ–å™¨ (ä½¿ç”¨)
    int m_z;                              // 1. é»˜è®¤åˆå§‹åŒ–ï¼ˆéšæœºå€¼ï¼‰

public:
    Foo(int x) : m_x { x } {              // 2. æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨
        std::cout << "Foo constructed\n"; // 4. æ„é€ å‡½æ•°ä½“
    }

    void print() const {
        std::cout << "Foo(" << m_x << ", " << m_y << ", " << m_z << ")\n";
    }
};

int main() {
    Foo foo { 6 };
    foo.print();
}
#+end_src

#+RESULTS:
: Foo constructed
: Foo(6, 2, 32765)

[fn:3]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Foo {
private:
    int m_x { };
    int m_y { };

public:
    Foo(int x=0, int y=0) : m_x { x } , m_y { y } {     // è¿™æ˜¯é»˜è®¤æ„é€ å‡½æ•°
        std::cout << "Foo(" << m_x << ", " << m_y << ") constructed\n";
    }
};

int main() {
    Foo foo1{};     // è°ƒç”¨ Foo(int, int)
    Foo foo2{6, 7}; // è°ƒç”¨ Foo(int, int)
    Foo foo3;       // è°ƒç”¨ Foo(int, int)
}
#+end_src

#+RESULTS:
: Foo(0, 0) constructed
: Foo(6, 7) constructed
: Foo(0, 0) constructed

#+name: é¿å…æœ‰æ­§ä¹‰çš„è°ƒç”¨
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Foo {
private:
    int m_x {};
    int m_y {};
public:
    Foo() {                                        // é»˜è®¤æ„é€ å‡½æ•°
        std::cout << "Foo constructed\n";
    }
    Foo(int x=1, int y=2) : m_x { x }, m_y { y } { // é»˜è®¤æ„é€ å‡½æ•°
        std::cout << "Foo(" << m_x << ", " << m_y << ") constructed\n";
    }
};

int main() {
    //Foo foo{};   FIXME æœ‰æ­§ä¹‰çš„å‡½æ•°è°ƒç”¨
    Foo foo {1};
}
#+end_src

#+RESULTS: é¿å…æœ‰æ­§ä¹‰çš„è°ƒç”¨
: Foo(1, 2) constructed

[fn:4]
#+begin_src cpp
Foo foo{}; // å€¼åˆå§‹åŒ–, calls Foo() default constructor
Foo foo2;  // é»˜è®¤åˆå§‹åŒ–, calls Foo() default constructor
#+end_src

[fn:5]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class User {
private:
    int m_a;
    int m_b {};
public:
    User() {}             // NOTE ç”¨æˆ·å®šä¹‰ é»˜è®¤æ„é€ å‡½æ•°ï¼šm_a ä¸ºéšæœºå€¼
    int a() const { return m_a; }
    int b() const { return m_b; }
};

class Default {
private:
    int m_a;
    int m_b {};
public:
    Default() = default;  // NOTE =default é»˜è®¤æ„é€ å‡½æ•°ï¼šm_a ä¸º 0
    int a() const { return m_a; }
    int b() const { return m_b; }
};

class Implicit {
private:
    int m_a;
    int m_b {};
public:
                          // NOTE éšå¼é»˜è®¤æ„é€ å‡½æ•°ï¼šm_a ä¸º 0
    int a() const { return m_a; }
    int b() const { return m_b; }
};

int main() {
    User user{};
    std::cout << user.a() << ' ' << user.b() << '\n';

    Default def{};
    std::cout << def.a() << ' ' << def.b() << '\n';

    Implicit imp{};
    std::cout << imp.a() << ' ' << imp.b() << '\n';
}
#+end_src

#+RESULTS:
: 73728 0
: 0 0
: 0 0

[fn:6]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class MyClass {
public:
    MyClass(MyClass obj) { /* ... */ } // é”™è¯¯ï¼šæŒ‰å€¼ä¼ é€’
};

int main() {
    MyClass a;
    MyClass b(a); // FIXME è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°æ—¶ï¼Œéœ€è¦å…ˆæ‹·è´ a åˆ° objï¼Œåˆè§¦å‘æ‹·è´æ„é€ å‡½æ•° æ— é™é€’å½’
}
#+end_src

[fn:7]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Foo {
public:
    // NOTE Foo(int x, int y = 1) åŒç†
    Foo(int x) {
        cout << "å‘ç”Ÿéšå¼è½¬æ¢ï¼šè°ƒç”¨ Foo(int) -> " << x << '\n';
    }

    // NOTE Foo(int x = 1, int y = 1) åŒç†
    Foo(int x, int y ) {
        cout << "å‘ç”Ÿéšå¼è½¬æ¢ï¼šè°ƒç”¨ Foo(int, int) -> " << x << ' ' << y << '\n';
    }
};

void printFoo(Foo f) {}

int main() {
    printFoo(5);       // å‘ç”Ÿéšå¼è½¬æ¢ï¼šè°ƒç”¨ Foo(int)
    printFoo({6, 7});  // å‘ç”Ÿéšå¼è½¬æ¢ï¼šè°ƒç”¨ Foo(int, int)
}
#+end_src

[fn:8]
#+begin_src cpp :results output :namespaces std :includes <iostream> <string> <string_view>
class Employee {
public:
    Employee(std::string_view name) {}
};

void printEmployee(Employee e) {}

int main() {
    // const char* -> éšå¼è½¬æ¢ä¸º string_view -> éšå¼è½¬æ¢ä¸º Employee -> è°ƒç”¨ Employee(std::string_view)
    printEmployee("Joe"); // FIXME éœ€è¦2æ¬¡éšå¼è½¬æ¢ï¼Œä½†éšå¼è½¬æ¢åªèƒ½å‘é€1æ¬¡
    // NOTE è§£å†³æ–¹æ³•ï¼šprintEmployee("Jos"sv) æˆ– printEmployee(Employee{ "Joe" })
}
#+end_src

[fn:9]
#+begin_src cpp :results output :namespaces std :includes <iostream>
class Foo {
public:
    explicit Foo() {}
    explicit Foo(int x) {}
};

Foo getFoo() {
    return Foo{ };   // ok
    return { };      // FIXME ä¸èƒ½éšå¼è½¬æ¢ initializer list åˆ° Foo()

    return Foo{ 5 }; // ok
    return 5;        // FIXME ä¸èƒ½éšå¼è½¬æ¢ int åˆ° Foo(int)
    return { 5 };    // FIXME ä¸èƒ½éšå¼è½¬æ¢ initializer list åˆ° Foo(int)
}

int main() {
    getFoo();
}
#+end_src
