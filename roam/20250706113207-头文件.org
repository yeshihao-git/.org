:PROPERTIES:
:ID:       fbf786c2-5b6e-47a1-81b9-c1c644b567bb
:END:
#+title: 头文件
#+filetags: cpp

* 头文件
- 头文件 :: =.h= 结尾的文件，存放一系列的 [[id:ca54a01f-2f2f-4b35-b5e1-2bc51a5b456c][前向声明]]，用于 =include= 进其他文件
  *why* [fn:1]
  1. 用 预处理指令 #include *包含头文件*
     - #include <> 搜索路径 :: 系统目录
     - #include "" 搜索路径 :: 当前目录 -> 系统目录
  2. *头文件中不应该包含定义* ，会违反 [[id:c611b7e9-f4e4-4ac4-9a84-fddb01e4275e][单一定义规则]] [fn:2]， *除非使用 [[id:3e85303c-39c7-4ac3-9d88-a9513d036477][inline]] 定义*
     1) 每一个 include 这个头文件的源文件，都需要编译一遍 定义的函数（inline）-> 增加编译时间
     2) 对定义的函数修改，造成包含这个头文件的源文件重新编译
     3) 仅头文件的库 方便使用，直接 include
  3. *头文件重复包含问题* ，使用 头文件保护符 [fn:3]
  4. 不同头文件类型及 *所处命名空间*
     |---------+-----------------+--------------------|
     | 头文件  | 头文件类型      | 标识符所处命名空间 |
     |---------+-----------------+--------------------|
     | <xxx>   | cpp特有         | std                |
     | <cxxx>  | c兼容           | std，全局（可选）  |
     | <xxx.h> | cpp特有（古代） | 全局               |
     | <xxx.h> | c兼容（古代）   | 全局，std（可选）  |
     |---------+-----------------+--------------------|
     - 历史原因：委员会将标准库移到std命名空间，会导致以前使用 =<xxx.h>= 的程序失效，于是弄出了新的头文件 =<xxx>=
     因此 =<iostream>= 和 =<iostream.h>= 不相同，它们的命名空间不一样


* Footnotes

[fn:3]
#+name: square.h
#+begin_src cpp :results output :namespaces std :includes <iostream>
int getSquareSides() {
    return 4;
}
#+end_src
#+name: wave.h
#+begin_src cpp :results output :namespaces std :includes <iostream>
#include "square.h"
#+end_src
#+name: main.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
#include "square.h"
#include "wave.h"
int main() {
    return 0;
}
#+end_src
------------------------------*预处理*--------------------------------
#+name: main.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
int getSquareSides() { // from square.h
    return 4;
}

int getSquareSides() { // from wave.h (via square.h)
    return 4;
}

int main() {
    return 0;
}
#+end_src
重复定义 -> 编译错误
------------------------------*头文件保护符*----------------------------
#+name: square.h
#+begin_src cpp :results output :namespaces std :includes <iostream>
#ifndef SQUARE_H
#define SQUARE_H

int getSquareSides() {
    return 4;
}

#endif
#+end_src
#+name: wave.h
#+begin_src cpp :results output :namespaces std :includes <iostream>
#ifndef WAVE_H
#define WAVE_H

#include "square.h"

#endif
#+end_src
#+name: main.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
#include "square.h"
#include "wave.h"

int main() {
    return 0;
}
#+end_src
------------------------------*预处理后*------------------------------
#+name: main.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
// Square.h included from main.cpp
#ifndef SQUARE_H
#define SQUARE_H

int getSquareSides() {
    return 4;
}

#endif // SQUARE_H

// wave.h included from main.cpp
#ifndef WAVE_H
#define WAVE_H
#ifndef SQUARE_H // square.h included from wave.h, SQUARE_H is already defined from above
#define SQUARE_H // so none of this content gets included

int getSquareSides() {
    return 4;
}

#endif // SQUARE_H
#endif // WAVE_H

int main() {
    return 0;
}
#+end_src

[fn:2]
#+name: add.h
#+begin_src cpp :results output :namespaces std :includes <iostream>
// 头文件中 定义 add()
int add(int x, int y) {
    return x + y;
}
#+end_src
#+name: add.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
#include "add.h" // Contents of add.h copied here
#+end_src
#+name: main.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
#include "add.h"

int main() {
    std::cout << "The sum of 3 and 4 is " << add(3, 4) << '\n';
}
#+end_src

------------------------------*预处理*------------------------------
#+name: main.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
// from add.h:
int add(int x, int y) {
    return x + y;
}

int main() {
    std::cout << "The sum of 3 and 4 is " << add(3, 4) << '\n';
}
#+end_src
#+name: add.cpp
#+begin_src cpp :results output :namespaces std :includes <iostream>
int add(int x, int y) {
    return x + y;
}
#+end_src
---------------------------------*链接*--------------------------------
链接器 发现 add() 有两个定义：main.cpp、add.cpp -> 链接错误

[fn:1]
#+begin_comment
*场景* ：一个cpp文件A内有函数f，很多其他cpp文件要用f

前向声明方法 和 头文件方法 *对比*
- 前向声明：需在所有其他cpp文件中，前向声明f，随着文件数量增多，这将极其繁琐
- 头文件  ：我们将f放入头文件H中，在其他文件中#include即可
#+end_comment
