:PROPERTIES:
:ID:       6012c06e-c6c5-4001-a287-dfe05404724d
:END:
#+title: 库
#+filetags: cpp

* 库
- 库 :: 预先编写、编译好的可复用代码集合，用于提供常用功能（避免重复造轮子，提升开发效率）。分为：
  1. [[id:cd3176d3-f57c-4a7d-bb60-393cde1c2575][静态库]]
  2. [[id:cdbc225a-aaab-4361-82d7-6eac302992a3][动态库]]

*项目的库类型*
开源项目：
1. 仅头文件             ：使用方便（直接 include），增加编译时间
2. 头文件+源文件        ：使用麻烦，编译时间短

商业软件：
1. 头文件+预编译的库文件：不需要编译，直接链接，存在知识产权


** 静态库
:PROPERTIES:
:ID:       cd3176d3-f57c-4a7d-bb60-393cde1c2575
:END:
   - 静态库 :: 编译时，链接器将静态库代码直接嵌入可执行文件中
     1. 后缀：linux =.a= 、windows =.lib=

#+name: 制作静态态库
#+begin_example bash
g++ <源文件> -c -o <.o文件>
ar rcs lib<静态库名>.a <.o文件>
#+end_example

#+name: 示例
#+begin_src bash
.
├── app
│   └── demo01.cpp
└── tools
    ├── libpublic.a
    ├── public.cpp
    └── public.h
# 制作静态库
g++ ./tools/public.cpp -c -o public.o
ar rcs ./tools/libpublic.a ./tools/public.o

# 使用静态库
g++ ./app/demo01.cpp -o app -L./tools -lpublic
#+end_src


** 动态库
:PROPERTIES:
:ID:       cdbc225a-aaab-4361-82d7-6eac302992a3
:ROAM_ALIASES: 共享库
:END:
1. 库类型
   - 动态库 :: 运行时，程序会查找并加载所需的动态库
     1. 命名规则： =lib<动态库名>.so=
     2. 后缀：linux =.so= 、windows =.dll=

#+name: 制作动态库
#+begin_example bash
# 制作动态库
g++ <源代码>.cpp -fPIC -shared -o lib<动态库名>.so

# 使用动态库
g++ <源代码>.cpp -o <可执行文件名> -L<静态库文件所在目录> -l<需要链接的库名>
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:<动态库目录>   # 设置环境变量 LD_LIBRARY_PATH
#+end_example


* windows中的静态库和动态库
:PROPERTIES:
:ID:       6b97d4de-1a3f-4b1a-8f38-180880af3263
:END:
*静态库*
.lib：包含完整的二进制代码

*动态库*
.lib：中仅包含 DLL 中函数 / 符号的位置信息，用于编译时链接
.dll：包含实际执行代码
