:PROPERTIES:
:ID:       4012acd2-c162-4270-8c93-9922a3502f50
:END:
#+title: qt
#+filetags: cpp

* åŸºç¡€
** äº‹ä»¶ç³»ç»Ÿ
:PROPERTIES:
:ID:       18d086af-b1a7-4731-a91d-e1607b401171
:END:
- äº‹ä»¶ç³»ç»Ÿ :: Qtç¨‹åºå¯¹ å„ç§å¤–éƒ¨/å†…éƒ¨å˜åŒ– çš„å“åº”æœºåˆ¶ï¼Œäº‹ä»¶ç³»ç»Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºï¼š =äº‹ä»¶ç³»ç»Ÿ = äº§ç”Ÿ + å¾ªç¯ + è¿‡æ»¤ + åˆ†å‘ + å¤„ç†= ã€‚[[id:f488468e-c836-44a2-b8a7-46d2738bc7fc][ğŸ–¼ äº‹ä»¶ç³»ç»Ÿä¹‹äº‹ä»¶äº§ç”Ÿã€å¾ªç¯ã€è¿‡æ»¤ã€åˆ†å‘ã€å¤„ç†]]

*å·¥ä½œæµç¨‹* ï¼š[fn:1]
1. ç³»ç»Ÿäº§ç”Ÿäº‹ä»¶è¢«æ”¾å…¥ç³»ç»Ÿäº‹ä»¶é˜Ÿåˆ—ï¼Œqtå–å‡ºç³»ç»Ÿäº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶å°è£…ä¸ºqtäº‹ä»¶æ”¾å…¥qtäº‹ä»¶é˜Ÿåˆ—ï¼Œqtä¹Ÿä¼šäº§ç”Ÿäº‹ä»¶å¹¶æ”¾å…¥qtäº‹ä»¶é˜Ÿåˆ—
2. äº‹ä»¶å¾ªç¯ä¼šå–å‡ºqtäº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ç¡®å®šäº‹ä»¶çš„ç›®æ ‡å¯¹è±¡ï¼Œäº‹ä»¶å…ˆç»è¿‡å…¨å±€äº‹ä»¶è¿‡æ»¤å™¨ï¼ˆè‹¥appå¯¹è±¡å®‰è£…ï¼‰ï¼Œå†ç»è¿‡ç›®æ ‡å¯¹è±¡çš„äº‹ä»¶è¿‡æ»¤å™¨ï¼ˆè‹¥ç›®æ ‡å¯¹è±¡å®‰è£…ï¼‰ï¼Œå…·ä½“æ¥è¯´ä¼šè°ƒç”¨äº‹ä»¶è¿‡æ»¤å™¨çš„eventFilter()æ–¹æ³•ï¼Œè‹¥è¯¥æ–¹æ³•è¿”å›trueåˆ™æ‹¦æˆªäº‹ä»¶ä¸å†ç»§ç»­ä¼ é€’åˆ°ç›®æ ‡å¯¹è±¡ï¼Œè‹¥è¯¥æ–¹æ³•è¿”å›falseåˆ™ç»§ç»­ä¼ é€’åˆ°ç›®æ ‡å¯¹è±¡
3. ç›®æ ‡å¯¹è±¡æ¥æ”¶åˆ°äº‹ä»¶åä¼šè°ƒç”¨äº‹ä»¶å¤„ç†çš„å…¥å£ï¼ˆevent()æ–¹æ³•ï¼‰ï¼Œevent() é»˜è®¤ä¼šæ ¹æ®äº‹ä»¶ç±»å‹è°ƒç”¨å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°


*** ğŸ–¼ äº‹ä»¶ç³»ç»Ÿä¹‹äº‹ä»¶äº§ç”Ÿã€å¾ªç¯ã€è¿‡æ»¤ã€åˆ†å‘ã€å¤„ç† :ATTACH:
:PROPERTIES:
:ID:       f488468e-c836-44a2-b8a7-46d2738bc7fc
:END:
[[attachment:_20250916_140415screenshot.png]]


** å¯¹è±¡æ ‘
:PROPERTIES:
:ID:       c1b27c54-3d18-4f18-a4ff-d5383d2c8dc5
:END:
- å¯¹è±¡æ ‘ :: Qtå†…å­˜ç®¡ç†æœºåˆ¶ï¼Œç”¨äºé˜²æ­¢å†…å­˜æ³„æ¼
  1. QObjectä¸ºæ ¹èŠ‚ç‚¹çš„ç»§æ‰¿ä½“ç³»å½¢æˆçš„æ ‘çŠ¶ç»“æ„ï¼Œå½“æ ‘ä¸­æŸä¸ªå¯¹è±¡é”€æ¯æ—¶ï¼Œä¼šè‡ªåŠ¨é”€æ¯å®ƒçš„å­å­™ã€‚é¿å…å†…å­˜æ³„æ¼
  2. ä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶ï¼Œç›¸å…³çš„ä¿¡å·æ§½è¿æ¥ä¼šè‡ªåŠ¨æ–­å¼€


** ä¿¡å·æ§½
:PROPERTIES:
:ID:       350bb7f0-6acd-4a89-ab47-8433e99cef18
:END:
- ä¿¡å·æ§½ :: ç”¨äºå¯¹è±¡é—´é€šä¿¡ï¼Œè§£è€¦é€šä¿¡åŒæ–¹ï¼Œå…¶æ¬¡å®ƒç±»å‹å®‰å…¨ã€è¿æ¥å½¢å¼çµæ´»
  ï¼ˆè¦ä½¿ç”¨ä¿¡å·æ§½åŠŸèƒ½ ç±»è¦ç»§æ‰¿ QObjectï¼Œå¹¶åœ¨ç±»å£°æ˜ä¸­å¢åŠ  Q_OBJECTå®ï¼‰
  1. ä¸€ä¸ªä¿¡å· è¿æ¥ ä¸€ä¸ªæ§½
  2. ä¸€ä¸ªä¿¡å· è¿æ¥ å¦ä¸€ä¸ªä¿¡å·
  3. ä¸€ä¸ªä¿¡å· è¿æ¥ å¤šä¸ªæ§½
  4. å¤šä¸ªä¿¡å· è¿æ¥ ä¸€ä¸ªæ§½

*ç‰¹ç‚¹* ï¼š
- æ¾è€¦åˆ   :: å°†é€šä¿¡åŒæ–¹è§£è€¦ï¼ˆä¿¡å·å‘é€è€…åªéœ€è¦å‘é€ä¿¡å·ï¼Œä¸éœ€è¦çŸ¥é“æ¥æ”¶è€…çš„å­˜åœ¨ï¼›æ¥æ”¶è€…åªéœ€å…³è”ä¿¡å·ï¼Œå®ç°æ§½å‡½æ•°é€»è¾‘ï¼Œæ— éœ€äº†è§£å‘é€è€…ç»†èŠ‚ï¼‰
- ç±»å‹å®‰å…¨ :: ï¼ˆqt5ï¼‰å…ƒå¯¹è±¡ç³»ç»Ÿä¼šåœ¨ç¼–è¯‘æœŸæ£€æŸ¥ä¿¡å·æ§½çš„ å‚æ•°ç±»å‹ã€å‚æ•°æ•°é‡
- çµæ´»æ€§   ::
  1. ä¸€ä¸ªä¿¡å· è¿æ¥ ä¸€ä¸ªæ§½
  2. ä¸€ä¸ªä¿¡å· è¿æ¥ å¦ä¸€ä¸ªä¿¡å·
  3. ä¸€ä¸ªä¿¡å· è¿æ¥ å¤šä¸ªæ§½
  4. å¤šä¸ªä¿¡å· è¿æ¥ ä¸€ä¸ªæ§½

*connectionçš„2ç§å†™æ³•* ï¼š
- å­—ç¬¦ä¸²å® :: è¿è¡Œæ—¶ å­—ç¬¦ä¸²è§£ææ£€æŸ¥ï¼ˆé¢„å¤„ç†æ—¶æ›¿æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä¸åŒ…å«ç¼–è¯‘å™¨å¯è¯†åˆ«çš„ç±»å‹ä¿¡æ¯ï¼‰
- å‡½æ•°æŒ‡é’ˆ :: ç¼–è¯‘æ—¶ å‚æ•°ç±»å‹/æ•°é‡æ£€æŸ¥ -> é¿å…è¿è¡Œæ—¶å¼‚å¸¸ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥æ›´å®‰å…¨
#+begin_example cpp
// Qt4çš„å­—ç¬¦ä¸²å®æ–¹å¼
connect(sender, SIGNAL(valueChanged(int)), receiver, SLOT(onValueChanged(int)));

// æ›¿æ¢åçš„å­—ç¬¦ä¸²ä¸åŒ…å«ç¼–è¯‘å™¨å¯è¯†åˆ«çš„ç±»å‹ä¿¡æ¯
SIGNAL(func(int)) æ¢æˆ "2func(int)"

// Qt5çš„å‡½æ•°æŒ‡é’ˆæ–¹å¼
connect(sender, &Sender::valueChanged, receiver, &Receiver::onValueChanged);
// Qt5çš„å‡½æ•°æŒ‡é’ˆæ–¹å¼ï¼šæ”¯æŒè¿æ¥åˆ°lambdaè¡¨è¾¾å¼
connect(sender, &Sender::valueChanged, [](int value) {
    qDebug() << "Value changed:" << value;
});
#+end_example

*connectionè¿æ¥æ–¹å¼ï¼ˆç¬¬5ä¸ªå‚æ•°ï¼‰* ï¼š
- Qt::AutoConnectionï¼ˆé»˜è®¤ï¼‰   :: è‡ªåŠ¨è¿æ¥
  sender å’Œ receiver åœ¨åŒä¸€çº¿ç¨‹ ? ç›´æ¥è¿æ¥ : é˜Ÿåˆ—è¿æ¥

- Qt::DirectConnection         :: ç›´æ¥è¿æ¥
  ä¿¡å·è§¦å‘æ—¶ï¼Œå‘é€è€…çº¿ç¨‹ç›´æ¥è°ƒç”¨æ§½å‡½æ•°

- Qt::QueuedConnection         :: é˜Ÿåˆ—è¿æ¥
  ä¿¡å·è§¦å‘æ—¶ï¼Œqtä¼šå°†ä¿¡å·æ‰“åŒ…æˆ qtäº‹ä»¶ï¼Œæ”¾å…¥æ¥æ”¶è€…çº¿ç¨‹çš„äº‹ä»¶é˜Ÿåˆ—ï¼Œæ¥æ”¶è€…çº¿ç¨‹è¿è¡Œäº‹ä»¶å¾ªç¯ä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶å¹¶æ‰§è¡Œæ§½å‡½æ•°

- Qt::BlockingQueuedConnection :: é˜»å¡é˜Ÿåˆ—è¿æ¥
  ç±»ä¼¼é˜Ÿåˆ—è¿æ¥ï¼Œå‘é€è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ¥æ”¶è€…çº¿ç¨‹ä¸­çš„æ§½å‡½æ•°æ‰§è¡Œå®Œæ¯•

- Qt::UniqueConnection         :: å”¯ä¸€è¿æ¥
  ä¸å…¶ä»–è¿æ¥æ–¹å¼ç»„åˆä½¿ç”¨ï¼Œç”¨äºç¡®ä¿ åŒä¸€ä¿¡å·æ§½ä¹‹é—´ä¸ä¼šå»ºç«‹é‡å¤è¿æ¥
  #+begin_example cpp
  connect(sender, &Sender::signal, receiver, &Receiver::slot, Qt::AutoConnection | Qt::UniqueConnection);
  #+end_example

ä¿¡å·æ§½æœºåˆ¶å®ç°ä¾èµ– *å…ƒå¯¹è±¡ç³»ç»Ÿ*


*** ä¿¡å·æ§½åº•å±‚åŸç†
:PROPERTIES:
:ID:       0235f0fc-df6c-4ebb-8dc5-26b2b845ee1d
:END:
1. å…ƒå¯¹è±¡ç¼–è¯‘å™¨ï¼ˆmocï¼‰æ‰«æå¸¦æœ‰Q_OBJECTå®çš„ç±»ï¼Œæå–ä¿¡å·ã€æ§½ç­‰å…ƒä¿¡æ¯ï¼Œç”Ÿæˆ moc_XXX.cpp æ–‡ä»¶
2. ç¨‹åºè¿è¡Œåˆ° QObject::connectï¼Œä»å‘é€è€…å’Œæ¥æ”¶è€…å…³è”çš„mocæ–‡ä»¶ä¸­å–å‡ºä¿¡å·ã€æ§½å¯¹åº”çš„å…ƒç´¢å¼•ï¼Œå°† â€œå‘é€è€…æŒ‡é’ˆã€ä¿¡å·ç´¢å¼•ã€æ¥æ”¶è€…æŒ‡é’ˆã€æ§½å‡½æ•°ç´¢å¼•â€ ç­‰ä¿¡æ¯å­˜å…¥å†…å­˜ä¸­çš„QObjectå†…éƒ¨è¿æ¥åˆ—è¡¨
3. ä¿¡å·è§¦å‘ï¼Œè°ƒç”¨å‘é€è€…mocæ–‡ä»¶ä¸­çš„ä¿¡å·å‡½æ•°ï¼Œä¿¡å·å‡½æ•°å†…éƒ¨è°ƒç”¨ QMetaObject::activate() éå† QObjectå†…éƒ¨è¿æ¥åˆ—è¡¨ æ‰¾åˆ°ä¸å½“å‰ä¿¡å·å…³è”çš„æ‰€æœ‰ â€œæ¥æ”¶è€…-æ§½â€å¯¹ï¼Œæ ¹æ®connectè¿æ¥ç±»å‹é€‰æ‹© ç›´æ¥è°ƒç”¨ æˆ– é€šè¿‡äº‹ä»¶é˜Ÿåˆ—è°ƒç”¨ æ§½å‡½æ•°ï¼Œæ ¹æ®æ§½å‡½æ•°çš„å…ƒç´¢å¼•æ‰¾åˆ°æ§½å‡½æ•°å¹¶è°ƒç”¨

ç›¸å…³ä»£ç è§ï¼š[fn:2]
#+begin_example cpp
Tom::miao() â†’ QMetaObject::activate() â†’ æŸ¥æ‰¾è¿æ¥åˆ—è¡¨ â†’ æ‰¾åˆ° jerry å’Œå…¶æ§½ç´¢å¼• â†’ è°ƒç”¨ Jerry::qt_static_metacall() â†’ æ‰§è¡Œ Jerry::runAway()
#+end_example


** TODO å±æ€§ç³»ç»Ÿ


** TODO å…ƒå¯¹è±¡ç³»ç»Ÿ
æ ¸å¿ƒï¼šå…ƒå¯¹è±¡ç³»ç»Ÿæ˜¯Qtå®ç°ä¿¡å·æ§½ã€åå°„ç­‰ç‰¹æ€§çš„åŸºç¡€ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶è·å–/æ“ä½œç±»çš„å…ƒä¿¡æ¯ï¼ˆå¦‚ç±»åã€æ–¹æ³•ã€å±æ€§ç­‰ï¼‰ã€‚

å…³é”®ç»„ä»¶ï¼š
1. `Q_OBJECT` å®ï¼šè§¦å‘å…ƒå¯¹è±¡ä»£ç ç”Ÿæˆï¼ˆéœ€æ”¾åœ¨ç±»å£°æ˜ä¸­ï¼‰ã€‚
2. å…ƒå¯¹è±¡ç¼–è¯‘å™¨ï¼ˆmocï¼‰ï¼šé¢„å¤„ç†å« `Q_OBJECT` çš„ç±»ï¼Œç”Ÿæˆå…ƒä¿¡æ¯ä»£ç ï¼ˆå¦‚ä¿¡å·æ§½å…³è”é€»è¾‘ï¼‰ã€‚
3. `QMetaObject` ç±»ï¼šæä¾›è¿è¡Œæ—¶è®¿é—®å…ƒä¿¡æ¯çš„æ¥å£ï¼ˆå¦‚ `className()`ã€`invokeMethod()` ç­‰ï¼‰ã€‚
4. ç»§æ‰¿ `QObject`ï¼šç±»éœ€ç»§æ‰¿ `QObject` ä»¥å¯ç”¨å…ƒå¯¹è±¡åŠŸèƒ½ã€‚

*** tmp
QObjectç±» ä¸ºå¯ä»¥åˆ©ç”¨å…ƒå¯¹è±¡ç³»ç»Ÿçš„å¯¹è±¡æä¾›äº†åŸºç±»
Q_OBJECTå® å¼€å¯å…ƒå¯¹è±¡åŠŸèƒ½
moc å®ç°å…ƒå¯¹è±¡åŠŸèƒ½

å…ƒå¯¹è±¡ç³»ç»Ÿ ç”¨äºå®ç° ä¿¡å·æ§½æœºåˆ¶ã€åå°„ï¼ˆQObject::metaObject()ï¼‰


* æ¨¡å‹/è§†å›¾ç¼–ç¨‹
:PROPERTIES:
:ID:       0b3d6765-2f2d-4a04-975a-66ad118cad4b
:END:
*ç»„ä»¶*
- æ¨¡å‹ :: è´Ÿè´£ å­˜å‚¨æ•°æ® ä»¥åŠ æä¾›æ•°æ®çš„è¯»å†™æ¥å£
- è§†å›¾ :: è´Ÿè´£ ä»æ¨¡å‹åŒæ­¥æ•°æ®å¹¶æ˜¾ç¤º ä»¥åŠ å°†ç”¨æˆ·äº¤äº’åŒæ­¥ç»™æ¨¡å‹
- å§”æ‰˜ :: è´Ÿè´£ è§†å›¾é¡¹çš„è‡ªå®šä¹‰æ˜¾ç¤º ä»¥åŠ è‡ªå®šä¹‰ç¼–è¾‘[fn:3]
æ¨¡å‹ç´¢å¼•ï¼ˆQModelIndexï¼‰ï¼šæ˜¯ä¸‰è€…çš„æ¡¥æ¢
åä½œå…³ç³»è§ï¼š[[id:19cef532-11de-49cb-9173-cebb2c6f2c43][ğŸ–¼ æ¨¡å‹/è§†å›¾æ¶æ„]]

*æ ¸å¿ƒAPI*
1. æ¨¡å‹ é€šè¿‡ data()/setData() æä¾›æ•°æ®è¯»å†™æ¥å£
2. è§†å›¾ é€šè¿‡ setModel() ç»‘å®šæ¨¡å‹ ä»¥åŠ å“åº”ä¿¡å·å®ç°æ˜¾ç¤ºä¸äº¤äº’è§¦å‘
3. å§”æ‰˜ é€šè¿‡ paint()/createEditor() ç­‰å®ç°é¡¹çš„è‡ªå®šä¹‰æ˜¾ç¤ºä¸ç¼–è¾‘ï¼Œå¹¶é€šè¿‡ setEditorData()/setModelData() å®Œæˆæ•°æ®åœ¨æ¨¡å‹ä¸ç¼–è¾‘å™¨çš„åŒæ­¥

*æ¨¡å‹/è§†å›¾ç¼–ç¨‹çš„ä¼˜åŠ¿*
1. ä¼ ç»Ÿç»„ä»¶     ï¼šè§†å›¾å’Œæ•°æ®ä¸€ä½“
2. æ¨¡å‹/è§†å›¾ç»„ä»¶ï¼šè§£è€¦è§†å›¾å’Œæ•°æ®
   - å¯ç»´æŠ¤æ€§ :: åªè¦ä¸ä¿®æ”¹æ¨¡å‹çš„æ ‡å‡†æ¥å£ï¼ˆdata()ã€setData()ã€dataChanged()ä¿¡å·ï¼‰ï¼Œä¿®æ”¹æ¨¡å‹å’Œè§†å›¾äº’ä¸å½±å“
   - ç»„ä»¶å¤ç”¨ :: ä¸€ä¸ªæ¨¡å‹å¯ä»¥è¢«å¤šä¸ªè§†å›¾å¤ç”¨
   - çµæ´»æ‰©å±• :: æ”¯æŒè‡ªå®šä¹‰æ¨¡å‹/è§†å›¾/å§”æ‰˜å®ç°å¤æ‚éœ€æ±‚ï¼Œæ‰©å±•æ€§å¼º

ğŸ“ [[https://doc.qt.io/qt-6/model-view-programming.html#introduction-to-model-view-programming][Qt doc:model-view-programming]]


** ğŸ–¼ æ¨¡å‹/è§†å›¾æ¶æ„ :ATTACH:
:PROPERTIES:
:ID:       19cef532-11de-49cb-9173-cebb2c6f2c43
:END:
[[attachment:_20251011_163129screenshot.png]]


** ğŸ–¼ ä¸‰ç§è§†å›¾ :ATTACH:
:PROPERTIES:
:ID:       8304c96d-89a8-4a0c-bc08-861ccc5260a6
:END:
[[attachment:_20251004_172251screenshot.png]]
åˆ—è¡¨ã€è¡¨æ ¼ã€æ ‘


* QWidgetã€QDialogã€QMainWindow
*ç»§æ‰¿å…³ç³»*
QWidget -+- QDialog
         +- QMainWindow

*ä¸»çª—å£* ï¼ˆQMainWindowï¼‰
ä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¸»ç•Œé¢ï¼Œç»“æ„å¦‚ä¸‹ï¼š
- èœå•æ ï¼ˆmenuBar()ï¼‰
- å·¥å…·æ ï¼ˆtoolBar()ï¼‰
- çŠ¶æ€æ ï¼ˆstatusBar()ï¼‰
- ä¸­å¿ƒéƒ¨ä»¶ï¼ˆcentralWidget()ï¼Œå¿…é¡»è®¾ç½®ï¼Œç”¨äºæ”¾ç½®ä¸»è¦å†…å®¹ï¼‰
- Dock çª—å£ï¼ˆæ¡Œé¢æµ®åŠ¨çª—å£ï¼‰

*å¯¹è¯æ¡†* ï¼ˆQDialogï¼‰
ä¸ç”¨æˆ·äº¤äº’çš„çª—å£ï¼ŒçŸ­æœŸå­˜åœ¨

*QWidgetçš„å‡ ä½•ç»“æ„*
è§ï¼š[[id:71a4df45-b4de-47e3-9995-de2451470a90][ğŸ–¼ QWidgetçš„å‡ ä½•ç»“æ„]]

ğŸ“ [[https://doc.qt.io/qt-6/dialogs.html][Qt doc:dialogs]] [[https://doc.qt.io/qt-6/application-windows.html][Qt doc:mainwindow]]


** ğŸ–¼ QWidgetçš„å‡ ä½•ç»“æ„ :ATTACH:
:PROPERTIES:
:ID:       71a4df45-b4de-47e3-9995-de2451470a90
:END:
[[attachment:_20251014_153412screenshot.png]]


* æ ·å¼ï¼ˆQStyleï¼‰
QStyleæŠ½è±¡åŸºç±»å°è£…äº†GUIçš„å¤–è§‚å’Œé£æ ¼ï¼Œwidgetsä½¿ç”¨å®ƒæ¥æ‰§è¡Œå‡ ä¹æ‰€æœ‰çš„ç»˜åˆ¶å·¥ä½œ

*ç»§æ‰¿å…³ç³»*
QStyle -+- QProxyStyle (ç”¨äºåœ¨å·²æœ‰æ ·å¼åšå±€éƒ¨è°ƒæ•´)
        +- QCommonStyle(ç”¨äºä»é›¶åšä¸€ä¸ªå…¨æ–°æ ·å¼)

*æ ·å¼å…ƒç´ *
1. åŸºæœ¬å…ƒç´     ï¼šçº¯è¢«åŠ¨è£…é¥°ï¼Œä¸å‚ä¸äº¤äº’ï¼Œä»…ä½œè§†è§‰å‘ˆç°
2. æ§ä»¶å…ƒç´     ï¼šä¸ç”¨æˆ·äº¤äº’ç»‘å®šï¼ŒéšçŠ¶æ€åŠ¨æ€å˜åŒ–çš„äº¤äº’æ€§è£…é¥°
3. å¤æ‚æ§ä»¶å…ƒç´ ï¼šåŒ…å«å­æ§ä»¶ï¼Œéœ€åè°ƒå­å…ƒç´ å¸ƒå±€ä¸çŠ¶æ€çš„å¤åˆäº¤äº’è£…é¥°

*QStyleç»˜åˆ¶æ ·å¼å…ƒç´ çš„å‡½æ•°æ‰€æ¥æ”¶çš„4ä¸ªå‚æ•°* ï¼ˆ =drawPrimitive()= ã€ =drawControl()= ã€ =drawComplexControl()= ï¼‰
# å¤§å¤šæ•°æ¥æ”¶4ä¸ªå‚æ•°
1. ä¸€ä¸ªæšä¸¾å€¼           ï¼šè¦ç»˜åˆ¶çš„å…ƒç´ 
2. ä¸€ä¸ªQStyleOption     ï¼šç»˜åˆ¶å…ƒç´ æ ·å¼æ‰€éœ€ä¿¡æ¯ï¼ˆå¦‚ä½•ä»¥åŠåœ¨ä½•å¤„ç»˜åˆ¶è¯¥å…ƒç´ ï¼‰
3. ä¸€ä¸ªQPainter         ï¼šç”¨äºç»˜åˆ¶å…ƒç´ 
4. ä¸€ä¸ªæ‰§è¡ŒQWidgetçš„æŒ‡é’ˆï¼šè¢«ç»˜åˆ¶å…ƒç´ æ‰€åœ¨çš„widgetï¼ˆå¯é€‰ï¼‰

ğŸ“ [[https://doc.qt.io/qt-6/style-reference.html#customizing-a-style][Qt doc:style]]


* å¸ƒå±€ç®¡ç†
ç”¨äºè‡ªåŠ¨æ’åˆ—éƒ¨ä»¶ä¸­çš„å­éƒ¨ä»¶

*å¸ƒå±€åŸç†*
1. æŒ‰ å°ºå¯¸æç¤º + å°ºå¯¸ç­–ç•¥ åˆ†é…é»˜è®¤ç©ºé—´
2. æŒ‰ æ‹‰ä¼¸å› å­æ¯”ä¾‹ åˆ†é…é¢å¤–ç©ºé—´
3. å‰©ä½™ç©ºé—´ç»™ â€œæ‹‰ä¼¸å› å­æ¯”ä¾‹0ï¼ŒExpandingâ€ç»„ä»¶
4. ç”¨ â€œæœ€å°å°ºå¯¸å…œåº•ã€æœ€å¤§å°ºå¯¸å°é¡¶â€ ä¿®æ­£è¾¹ç•Œ
#+begin_comment
sizeHintï¼ˆå°ºå¯¸æç¤ºï¼‰ï¼šç»„ä»¶ â€œæœŸæœ›â€ çš„é»˜è®¤å¤§å°ã€‚æ˜¯ç»„ä»¶çš„ â€œå»ºè®®å°ºå¯¸â€ï¼ˆå¦‚ QPushButton çš„é»˜è®¤å¤§å°ç”±æ–‡å­—é•¿åº¦å†³å®šï¼‰ï¼Œå¸ƒå±€ä¼šä¼˜å…ˆå‚è€ƒï¼Œä½†ä¸æ˜¯å¼ºåˆ¶å€¼ã€‚

sizePolicyï¼ˆå°ºå¯¸ç­–ç•¥ï¼‰ï¼šç»„ä»¶å¯¹ â€œé¢å¤–ç©ºé—´â€ çš„æ€åº¦ã€‚æ ¸å¿ƒæ˜¯QSizePolicyæšä¸¾ï¼Œæ¯”å¦‚ï¼š
- Fixedï¼šå›ºå®šå¤§å°ï¼Œæ‹’ç»ä»»ä½•é¢å¤–ç©ºé—´ï¼ˆåªæŒ‰ sizeHint æ˜¾ç¤ºï¼‰
- Minimumï¼šæœ€å°ä¸º sizeHintï¼Œå¯æ¥å—é¢å¤–ç©ºé—´ï¼ˆä½†ä¸ä¸»åŠ¨äº‰å–ï¼‰
- Expandingï¼šä¸»åŠ¨äº‰å–é¢å¤–ç©ºé—´ï¼ˆä¼˜å…ˆåˆ†é…å¤šä½™ç©ºé—´ï¼‰
- Maximumï¼šæœ€å¤§ä¸º sizeHintï¼Œç©ºé—´ä¸è¶³æ—¶å¯ç¼©å°

æ‹‰ä¼¸å› å­ï¼ˆStretch Factorï¼‰ï¼šå¸ƒå±€ä¸­ç»„ä»¶åˆ†é… â€œé¢å¤–ç©ºé—´â€ çš„æ¯”ä¾‹
#+end_comment

ğŸ“ [[https://doc.qt.io/qt-6/layout.html][Qt doc:layout]]


* Qtæ ·å¼è¡¨
# ç±»ä¼¼ CSSè¯­æ³•
ç”¨äºè‡ªå®šä¹‰éƒ¨ä»¶å¤–è§‚

- é€‰æ‹©å™¨       :: æŒ‡å®šæ ·å¼è§„åˆ™ä½œç”¨çš„ éƒ¨ä»¶
- é€‰æ‹©å™¨å­æ§ä»¶ :: æŒ‡å®šæ ·å¼è§„åˆ™ä½œç”¨çš„ éƒ¨ä»¶çš„å­æ§ä»¶ï¼ˆegï¼šQComboBoxçš„ä¸‹æ‹‰æŒ‰é’®ï¼‰
- é€‰æ‹©é¢˜ä¼ªçŠ¶æ€ :: æŒ‡å®šæ ·å¼è§„åˆ™ä½œç”¨çš„ éƒ¨ä»¶çš„çŠ¶æ€

*æ ·å¼å†²çªè§£å†³è§„åˆ™*
1. æ ¹æ®é€‰æ‹©å™¨çš„ç‰¹å¼‚æ€§å†³å®šï¼šè¶Šç‰¹å¼‚çš„é€‰æ‹©å™¨çš„æ ·å¼ä¼˜å…ˆ
2. æ ¹æ®çº§è”å†³å®šï¼Œä¼˜å…ˆçº§  ï¼šQApplication > çˆ¶éƒ¨ä»¶ > å­éƒ¨ä»¶

*ç»§æ‰¿*
ä¸åŒäºCSSï¼ŒQtæ ·å¼è¡¨ä¸­å­å…ƒç´ ä¸ä¼šè‡ªåŠ¨ç»§æ‰¿çˆ¶å…ƒç´ æ ·å¼ï¼ŒQWidget::setFont()ã€QWidget::setPalette()å­å…ƒç´ ä¼šç»§æ‰¿çˆ¶å…ƒç´ æ ·å¼
#+begin_example cpp
qApp->setStyleSheet("QGroupBox { color: red; } ");             // QGroupBoxä¸­çš„å­å…ƒç´  ä¸ä¼šç»§æ‰¿ çˆ¶å…ƒç´ æ ·å¼
qApp->setStyleSheet("QGroupBox, QGroupBox * { color: red; }"); // QGroupBoxä¸­çš„å­å…ƒç´  ç»§æ‰¿     çˆ¶å…ƒç´ æ ·å¼
#+end_example

*ç›’å­æ¨¡å‹*
è§ï¼š[[id:f56c7653-55af-47ff-b0c5-a330754a97ab][ğŸ–¼ ç›’å­æ¨¡å‹]]

ğŸ“ [[https://doc.qt.io/qt-6/stylesheet.html][Qt doc:stylesheet]]


** ğŸ–¼ ç›’å­æ¨¡å‹ :ATTACH:
:PROPERTIES:
:ID:       f56c7653-55af-47ff-b0c5-a330754a97ab
:END:
[[attachment:_20251014_135929screenshot.png]]
å¤–è¾¹è·çŸ©å½¢ã€è¾¹æ¡†çŸ©å½¢ã€å†…è¾¹è·çŸ©å½¢ã€å†…å®¹çŸ©å½¢

* Footnotes

[fn:1]
#+begin_example cpp
#include <QApplication>
#include <QWidget>
#include <QMouseEvent>
#include <QDebug>

// äº‹ä»¶è¿‡æ»¤å™¨å¯¹è±¡
class EventFilter : public QObject {
    Q_OBJECT
protected:
    bool eventFilter(QObject *watched, QEvent *event) override {
        // è¿‡æ»¤é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
        if (event->type() == QEvent::MouseButtonPress) {
            qDebug() << "äº‹ä»¶è¿‡æ»¤å™¨ï¼šæ‹¦æˆªåˆ°é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶";
            // è¿”å›falseè¡¨ç¤ºäº‹ä»¶ç»§ç»­ä¼ é€’
            return false;
        }
        return QObject::eventFilter(watched, event);
    }
};

// è‡ªå®šä¹‰çª—å£ï¼ˆäº‹ä»¶ç›®æ ‡å¯¹è±¡ï¼‰
class MyWidget : public QWidget {
    Q_OBJECT
protected:
    // äº‹ä»¶åˆ†å‘å™¨
    bool event(QEvent *event) override {
        if (event->type() == QEvent::MouseButtonPress) {
            qDebug() << "äº‹ä»¶åˆ†å‘å™¨ï¼šæ”¶åˆ°é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œå‡†å¤‡è°ƒç”¨å¤„ç†å‡½æ•°";
            // è°ƒç”¨çˆ¶ç±»å®ç°ï¼Œä¼šè‡ªåŠ¨åˆ†å‘åˆ°mousePressEvent
            return QWidget::event(event);
        }
        return QWidget::event(event);
    }

    // å…·ä½“äº‹ä»¶å¤„ç†å‡½æ•°
    void mousePressEvent(QMouseEvent *event) override {
        qDebug() << "äº‹ä»¶å¤„ç†å‡½æ•°ï¼šå¤„ç†é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œä½ç½®ï¼š"
                 << event->x() << "," << event->y();
        QWidget::mousePressEvent(event);
    }
};

int main(int argc, char *argv[]) {
    QApplication app(argc, argv);

    MyWidget widget;
    EventFilter filter;

    // ä¸ºçª—å£å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨
    widget.installEventFilter(&filter);

    widget.resize(300, 200);
    widget.show();

    qDebug() << "è¿›å…¥äº‹ä»¶å¾ªç¯";
    // å¯åŠ¨äº‹ä»¶å¾ªç¯
    return app.exec();
}

#include "main.moc"
#+end_example

[fn:2]
#+name: Tom.h
#+begin_example cpp
class Tom : public QObject
{
    Q_OBJECT
public:
    Tom(QObject *parent = nullptr) : QObject(parent) { }
    void miaow() {
        qDebug() <<  u8"å–µ!" ;
        emit miao();
    }

signals:
    void miao();
};
#+end_example

#+name: Jerry.h
#+begin_example cpp
class Jerry : public QObject
{
    Q_OBJECT
public:
    Jerry(QObject *parent = nullptr) : QObject(parent) {}

public slots:
    void runAway() {
        qDebug() << u8"é‚£åªçŒ«åˆæ¥äº†ï¼Œå¿«æºœï¼" ;
    }
};
#+end_example

#+name: main.cpp
#+begin_example cpp
#include "Tom.h"
#include "Jerry.h"
int main(int argc, char *argv[]) {
    QCoreApplication a(argc, argv);
    Tom tom;
    Jerry jerry;

    QObject::connect(&tom, &Tom::miao, &jerry, &Jerry::runAway);
    tom.miaow();

    return a.exec();
}
#+end_example

#+name: Q_OBJECTå®
#+begin_example cpp
public: \
    QT_WARNING_PUSH \
    Q_OBJECT_NO_OVERRIDE_WARNING \
    static const QMetaObject staticMetaObject; \
    virtual const QMetaObject *metaObject() const; \
    virtual void *qt_metacast(const char *); \
    virtual int qt_metacall(QMetaObject::Call, int, void **); \
    QT_TR_FUNCTIONS \
private: \
    Q_OBJECT_NO_ATTRIBUTES_WARNING \
    Q_DECL_HIDDEN_STATIC_METACALL static void qt_static_metacall(QObject *, QMetaObject::Call, int, void **); \
    QT_WARNING_POP \
    struct QPrivateSignal {}; \
    QT_ANNOTATE_CLASS(qt_qobject, "")
/******************å…³é”®éƒ¨åˆ†***********************/
static const QMetaObject staticMetaObject;
virtual const QMetaObject *metaObject() const;
virtual void *qt_metacast(const char *);
virtual int qt_metacall(QMetaObject::Call, int, void **);
static void qt_static_metacall(QObject *, QMetaObject::Call, int, void **)
#+end_example

[fn:3]
#+begin_comment
1. æ˜¾ç¤ºæ—¶ï¼Œé€šè¿‡ paint() ç­‰æ–¹æ³•è‡ªå®šä¹‰é¡¹çš„å¤–è§‚ï¼ˆå¦‚ç”¨è¿›åº¦æ¡å±•ç¤ºæ•°å€¼ï¼‰ï¼›
2. ç¼–è¾‘æ—¶ï¼Œå…ˆé€šè¿‡ setEditorData() å°†æ¨¡å‹æ•°æ®åŒæ­¥åˆ°ç¼–è¾‘å™¨ï¼ˆåˆå§‹åŒ–ç¼–è¾‘å™¨ï¼‰ï¼Œç”¨æˆ·è¾“å…¥åï¼Œå†é€šè¿‡ setModelData() å°†ç¼–è¾‘å™¨æ•°æ®åŒæ­¥åˆ°æ¨¡å‹ï¼›
3. æ¨¡å‹æ¥æ”¶æ–°æ•°æ®åï¼Œé€šè¿‡ dataChanged ä¿¡å·é€šçŸ¥è§†å›¾ï¼Œæœ€ç»ˆç”±è§†å›¾åˆ·æ–°æ˜¾ç¤ºã€‚
#+end_comment
